<!DOCTYPE html>
<html lang="pt-BR">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>[Tradu√ß√£o] Tudo o que voc√™ precisa saber sobre configura√ß√£o e gerenciamento de segredos em .NET | carlos schults / blog</title>
  <link rel="apple-touch-icon" sizes="57x57" href="/img/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/img/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/img/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/img/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/img/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/img/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/img/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/img/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/img/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  <meta name="description" content="      ‚ÑπÔ∏è    NOTA        Este post √© uma tradu√ß√£o, cuja publica√ß√£o foi autorizada pelo autor. Caso tenha interesse, leia o artigo original, em ingl√™s..Eu deci...">
  
  <!-- Twitter card -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:creator" content="@carlosschults">
  <meta name="twitter:site" content="@carlosschults">
  <meta name="twitter:domain" content="carlosschults.net">
  <meta name="twitter:title" content="[Tradu√ß√£o] Tudo o que voc√™ precisa saber sobre configura√ß√£o e gerenciamento de segredos em .NET">
  <meta name="twitter:description" content="      ‚ÑπÔ∏è    NOTA        Este post √© uma tradu√ß√£o, cuja publica√ß√£o foi autorizada pelo autor. Caso tenha interesse, leia o artigo original, em ingl√™s..Eu deci...">

   <!-- Facebook meta -->
  
  
  <meta property="og:title" content="[Tradu√ß√£o] Tudo o que voc√™ precisa saber sobre configura√ß√£o e gerenciamento de segredos em .NET">
  <meta property="og:site_name" content="Carlos Schults / Blog" />
  <meta property="og:locale" content="pt_BR">  
  <meta property="og:type" content="article" />
  <meta property="og:image" content="https://res.cloudinary.com/dz5ppacuo/image/upload/v1513817072/csharp8-1037x438_skogpz.jpg" />  
  <meta property="og:image:type" content="image/jpeg">
  <meta property="og:image:width" content="1038"> 
  <meta property="og:image:height" content="437">  
  
  <meta property="og:article:published_time" content="2024-07-23T00:00:00+00:00" />  
  <meta property="og:article:author" content="Sander ten Brinke, Carlos Schults (tradu√ß√£o)" />
  
  <meta property="og:article:tag" content="csharp" />
  <meta property="og:article:tag" content="dotnet" />
  <meta property="og:article:tag" content="configuracao" />
  <meta property="og:article:tag" content="traducoes" />
  <meta property="og:article:tag" content="tutorial" />    
  
  <meta property="og:url" content="https://carlosschults.net/pt/configuracao-dotnet"/>
  <meta property="og:description" content="      ‚ÑπÔ∏è    NOTA        Este post √© uma tradu√ß√£o, cuja publica√ß√£o foi autorizada pelo autor. Caso tenha interesse, leia o artigo original, em ingl√™s..Eu deci...">
  <link rel="stylesheet" href="/css/main.css">  
  
   <link rel="canonical" href="https://carlosschults.net/pt/configuracao-dotnet">
   
  
  <link rel="alternate" hreflang="pt" href="/pt/configuracao-dotnet" />
  
  <link rel="alternate" type="application/rss+xml" title="carlos schults / blog" href="https://carlosschults.net/rss.xml">
</head>

  <body>
    <header class="site-header">
  <div class="wrapper">    
    <a class="site-title" href="/pt/">carlos schults / blog</a>
    
    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">        
          
          <a class="page-link" href="/sobre/">Sobre</a>
          <a class="page-link" href="/busca/">Busca</a>
                  
      </div>
    </nav>

  </div>

</header>

<div class="wrapper" style="text-align: right; line-height: 2em">
  
   <a href="/pt/configuracao-dotnet" class="pt">pt</a> 

  
  
</div>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">    
    <h2 class="postTitle" itemprop="headline">[Tradu√ß√£o] Tudo o que voc√™ precisa saber sobre configura√ß√£o e gerenciamento de segredos em .NET</h2>
    <p class="post-meta">   
    <time datetime="2024-07-23T00:00:00+00:00" itemprop="datePublished">23/07/2024
    </time> ‚Ä¢ <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Sander ten Brinke, Carlos Schults (tradu√ß√£o)</span></span>
  <span class="tags" itemprop="keywords"> ‚Ä¢ Tags: <a href="/tag_ptbr/csharp">csharp </a> <a href="/tag_ptbr/dotnet">dotnet </a> <a href="/tag_ptbr/configuracao">configuracao </a> <a href="/tag_ptbr/traducoes">traducoes </a> <a href="/tag_ptbr/tutorial">tutorial </a> </span>
  </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p><img src="https://res.cloudinary.com/dz5ppacuo/image/upload/v1513817072/csharp8-1037x438_skogpz.jpg" alt="" /></p>

<div class="callout callout-info">
  <div class="callout-title">
    <span class="callout-icon">‚ÑπÔ∏è</span>
    NOTA
  </div>
  <div class="callout-content">
    
<p>Este post √© uma tradu√ß√£o, cuja publica√ß√£o foi autorizada pelo autor. Caso tenha interesse, <a href="https://stenbrinke.nl/blog/configuration-and-secret-management-in-dotnet/">leia o artigo original, em ingl√™s.</a>.</p>

<p>Eu decidi n√£o traduzir as imagens, pois achei que seria muito trabalhoso. Portanto, as figuras que voc√™ ver√° s√£o as mesmas do artigo original, com as informa√ß√µes nelas em ingl√™s.</p>

<p>Em respeito ao autor, procurei deixar o artigo o mais pr√≥ximo poss√≠vel do original: mantive <em>call to actions</em> que o autor faz para suas palestras e conte√∫dos, e tamb√©m mantive um pedido de contribu√ß√£o financeira ao final do artigo.</p>

<p>A partir do √≠ndice, inicia-se o artigo de autoria de Sander ten Brinke. Ap√≥s a conclus√£o do artigo, eu volto com algumas palavras antes de finalizar. Boa leitura!</p>


  </div>
</div>

<h2 id="√≠ndice">√çndice</h2>

<ul>
  <li><a href="#introdu√ß√£o">Introdu√ß√£o</a></li>
  <li><a href="#configura√ß√£o-no-net">Configura√ß√£o no .NET</a>
    <ul>
      <li><a href="#o-b√°sico">O b√°sico</a></li>
      <li><a href="#acesso-a-dados-estruturados">Acesso a dados estruturados</a></li>
      <li><a href="#como-tudo-isso-funciona">Como tudo isso funciona</a></li>
      <li><a href="#tratando-a-configura√ß√£o-como-c√≥digo">Tratando a configura√ß√£o como c√≥digo</a></li>
    </ul>
  </li>
  <li><a href="#options-pattern">options pattern</a>
    <ul>
      <li><a href="#inje√ß√£o-de-depend√™ncia">Inje√ß√£o de depend√™ncia</a></li>
      <li><a href="#valida√ß√£o">Valida√ß√£o</a></li>
      <li><a href="#tempos-de-vida-da-configura√ß√£o">Tempos de vida da configura√ß√£o</a></li>
    </ul>
  </li>
  <li><a href="#gerenciamento-de-segredos-durante-o-desenvolvimento">Gerenciamento de segredos durante o desenvolvimento</a>
    <ul>
      <li><a href="#o-provedor-de-configura√ß√£o-de-user-secrets">O provedor de configura√ß√£o de user secrets</a></li>
      <li><a href="#usando-user-secrets">Usando user secrets</a></li>
      <li><a href="#configurando-um-projeto-que-usa-user-secrets">Configurando um projeto que usa user-secrets</a></li>
    </ul>
  </li>
  <li><a href="#meu-modelo-para-gerenciamento-de-configura√ß√£o">Meu modelo para gerenciamento de configura√ß√£o</a>
    <ul>
      <li><a href="#appsettingsjson">appsettings.json</a></li>
      <li><a href="#appsettingsdevelopmentjson">appsettings.Development.json</a></li>
      <li><a href="#user-secrets">User Secrets</a></li>
    </ul>
  </li>
  <li><a href="#usando-o-azure-para-armazenar-a-configura√ß√£o">Usando o Azure para armazenar a configura√ß√£o</a>
    <ul>
      <li><a href="#armazenamento-de-segredos-no-azure-key-vault">Armazenamento de segredos no Azure Key Vault</a></li>
      <li><a href="#conectando-se-ao-azure-com-identidades-gerenciadas">Conectando-se ao Azure com identidades gerenciadas</a></li>
      <li><a href="#armazenamento-da-configura√ß√£o-na-configura√ß√£o-de-aplicativo-do-azure">Armazenamento da configura√ß√£o na Configura√ß√£o de Aplicativo do Azure</a></li>
    </ul>
  </li>
  <li><a href="#finalizando">Finalizando</a>
    <ul>
      <li><a href="#links-para-a-demo">Links para a demo</a></li>
      <li><a href="#links-para-a-documenta√ß√£o-oficial">Links para a documenta√ß√£o oficial</a></li>
    </ul>
  </li>
  <li><a href="#carlos-de-volta">Carlos de volta</a></li>
</ul>

<div class="callout callout-info">
  <div class="callout-title">
    <span class="callout-icon">‚ÑπÔ∏è</span>
    Info
  </div>
  <div class="callout-content">
    
<p>Este post √© um complemento da minha palestra <a href="https://sessionize.com/s/sander-ten-brinke/keep-it-secret-keep-it-safe-with-.net/48314">Keep it secret, keep it safe with .NET</a>! Se voc√™ n√£o puder assistir a uma sess√£o dessa palestra, poder√° ler este post em vez disso! Dessa forma, o maior n√∫mero poss√≠vel de pessoas poder√° aprender sobre o sistema de configura√ß√£o do .NET e como manter os segredos em seguran√ßa!</p>

<p>Minha palestra oferece algumas informa√ß√µes mais detalhadas, portanto, se quiser saber mais, d√™ uma olhada na minha p√°gina <a href="https://stenbrinke.nl/speaking">Speaking</a> para ver quando e onde darei essa palestra novamente! Voc√™ tamb√©m pode <a href="https://stenbrinke.nl/about/#contact-details">entrar em contato</a> se quiser que eu d√™ essa palestra em seu evento!</p>

  </div>
</div>

<h2 id="introdu√ß√£o">Introdu√ß√£o</h2>

<p>Se voc√™ j√° escreve c√≥digo h√° algum tempo, provavelmente j√° usou configura√ß√£o de alguma forma. Pense em feature flags, configura√ß√µes de log, configura√ß√µes de autentica√ß√£o etc. Talvez voc√™ tenha usado um arquivo de configura√ß√£o com algumas configura√ß√µes para o seu aplicativo ou talvez tenha usado vari√°veis de ambiente. Talvez voc√™ tenha usado ambos!</p>

<p>Tamb√©m √© prov√°vel que voc√™ tenha interagido com segredos, que tamb√©m considero parte de um sistema de configura√ß√£o. Pense em strings de conex√£o e chaves de API. Elas devem ser sempre seguras!</p>

<p>A configura√ß√£o no .NET mudou radicalmente desde a introdu√ß√£o do .NET Core. J√° se foi o tempo em que se usavam v√°rios arquivos <code class="language-plaintext highlighter-rouge">Web.config</code> e agora temos um sistema muito mais flex√≠vel. No entanto, um sistema flex√≠vel tamb√©m pode ser um sistema complexo. √â por isso que eu quis criar uma palestra e uma publica√ß√£o no blog em que voc√™ aprender√° como funciona o sistema de configura√ß√£o do .NET e como us√°-lo de forma otimizada. Voc√™ tamb√©m aprender√° a manter seus segredos seguros, tanto localmente quanto em produ√ß√£o, usando o poder da nuvem do Azure!</p>

<div class="callout callout-info">
  <div class="callout-title">
    <span class="callout-icon">‚ÑπÔ∏è</span>
    Info
  </div>
  <div class="callout-content">
    
<p>Este post cont√©m <strong>tudo</strong> que voc√™ precisa saber sobre configura√ß√£o e gerenciamento de segredos no .NET. Ela n√£o aborda todos os detalhes, mas abrange tudo o que acredito que um desenvolvedor .NET tem que saber. Considere-o um guia de bolso √∫til que voc√™ pode usar ou enviar a outras pessoas quando elas tiverem d√∫vidas sobre configura√ß√£o e gerenciamento de segredos no .NET.</p>

<p>Acho que esta post √© muito √∫til porque s√£o necess√°rias <strong>m√∫ltiplas horas</strong> para <em>encontrar</em> e ler completamente a documenta√ß√£o da Microsoft sobre esses t√≥picos. Se quiser saber mais, voc√™ encontrar√° links para a documenta√ß√£o oficial no final do post.</p>

  </div>
</div>

<p>Vamos come√ßar!</p>

<h2 id="configura√ß√£o-no-net">Configura√ß√£o no .NET</h2>

<p>O sistema de configura√ß√£o do .NET √© muito flex√≠vel! Voc√™ pode usar v√°rios provedores de configura√ß√£o, sendo que cada um deles pode ter um formato de configura√ß√£o diferente:</p>

<p><img src="/img/configuracao-dotnet/configuration-overview.webp" alt="Uma imagem que mostra uma vis√£o geral do sistema de configura√ß√£o do .NET com a interface IConfiguration e v√°rios provedores" /></p>

<p>Uma vis√£o geral do sistema de configura√ß√£o do .NET.<br />
<a href="https://learn.microsoft.com/dotnet/core/extensions/configuration?WT.mc_id=DT-MVP-5005050#concepts-and-abstractions">Extra√≠do da documenta√ß√£o oficial</a></p>

<p>Outras fontes podem ser arquivos como <code class="language-plaintext highlighter-rouge">.xml</code>, <code class="language-plaintext highlighter-rouge">.ini</code> e muito mais. Voc√™ pode at√© mesmo conectar seu sistema de configura√ß√£o √† nuvem, o que faremos mais adiante!</p>

<h3 id="o-b√°sico">O B√°sico</h3>

<p>Como voc√™ pode ver, toda a sua configura√ß√£o pode ser acessada usando a interface <code class="language-plaintext highlighter-rouge">IConfiguration</code>. Com isso, voc√™ pode recuperar seus valores de uma maneira fortemente tipada. Um exemplo:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="k">public</span> <span class="n">IConfiguration</span> <span class="n">Configuration</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="k">public</span> <span class="kt">string</span> <span class="nf">GetApiKey</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// GetValue&lt;&gt; permite que voc√™ passe o tipo de retorno</span>
    <span class="kt">string</span> <span class="n">method1</span> <span class="p">=</span> <span class="n">Configuration</span><span class="p">.</span><span class="n">GetValue</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;(</span><span class="err">‚Äú</span><span class="n">ApiKey</span><span class="err">‚Äù</span><span class="p">);</span> 

    <span class="c1">// A variante do indexador sempre retorna uma string</span>
    <span class="kt">string</span> <span class="n">method2</span> <span class="p">=</span> <span class="n">Configuration</span><span class="p">[</span><span class="err">‚Äú</span><span class="n">ApiKey</span><span class="err">‚Äù</span><span class="p">];</span> 

    <span class="k">return</span> <span class="n">method1</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>Voc√™ perceber√° que n√£o estamos especificando qual provedor deve ser usado para recuperar a <code class="language-plaintext highlighter-rouge">ApiKey</code>. Isso ocorre porque isso n√£o deveria importar; a <code class="language-plaintext highlighter-rouge">IConfiguration</code> esconde toda essa complexidade de n√≥s e, portanto, cria flexibilidade. O sistema de configura√ß√£o decide qual provedor usar com base na ordem dos provedores. Falaremos mais sobre isso mais tarde!</p>

<h3 id="acesso-a-dados-estruturados">Acesso a dados estruturados</h3>

<p>Um recurso muito avan√ßado do sistema de configura√ß√£o do .NET √© o fato de ele oferecer suporte a dados estruturados. Isso √© muito √∫til porque permite que voc√™ agrupe valores de configura√ß√£o relacionados. Todos os provedores oferecem suporte a dados estruturados, mas se voc√™ j√° trabalhou com um projeto ASP.NET Core, provavelmente reconhecer√° o mais comum, que √© <code class="language-plaintext highlighter-rouge">appsettings.json</code>. O JSON a seguir √© um exemplo de um arquivo desse tipo:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  ‚ÄúLogging": {
    ‚ÄúLogLevel": {
      ‚ÄúDefault‚Äù (Padr√£o): ‚ÄúInforma√ß√µes‚Äù,
      ‚ÄúMicrosoft.AspNetCore": ‚ÄúWarning‚Äù
    }
  },
  ‚ÄúAllowedHosts": ‚Äú*‚Äù,

  ‚ÄúConnectionStrings": {
    ‚ÄúBanco de dados": ‚ÄúCONNECTIONSTRING_HERE‚Äù
  },

  ‚ÄúFeatures‚Äù (Recursos): {
    ‚ÄúEnableNewUI": false
  }
}
</code></pre></div></div>

<p>Voc√™ pode imaginar o objeto raiz e as se√ß√µes <code class="language-plaintext highlighter-rouge">Logging</code>, <code class="language-plaintext highlighter-rouge">ConnectionStrings</code> e <code class="language-plaintext highlighter-rouge">Features</code> como ‚Äúdados estruturados‚Äù.</p>

<p>Para interagir com essas se√ß√µes no .NET, voc√™ pode usar o c√≥digo a seguir.</p>

<div class="callout callout-warning">
  <div class="callout-title">
    <span class="callout-icon">‚ö†Ô∏è</span>
    Aviso
  </div>
  <div class="callout-content">
    
<p>O c√≥digo a seguir n√£o √© a melhor maneira de interagir com dados estruturados! Falaremos sobre maneiras melhores (usando o padr√£o Options) <a href="#options-pattern">mais adiante</a>.</p>

  </div>
</div>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="k">public</span> <span class="n">IConfiguration</span> <span class="n">Configuration</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="c1">// ...</span>

<span class="k">public</span> <span class="n">IConfigurationSection</span> <span class="nf">GetFeaturesSection</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// GetSection retorna nulo quando a se√ß√£o n√£o pode ser encontrada</span>
    <span class="kt">var</span> <span class="n">method1</span> <span class="p">=</span> <span class="n">Configuration</span><span class="p">.</span><span class="nf">GetSection</span><span class="p">(</span><span class="err">‚Äú</span><span class="n">Features</span><span class="err">‚Äù</span><span class="p">);</span>

    <span class="c1">// GetRequiredSection dispara uma exce√ß√£o quando a se√ß√£o n√£o pode ser encontrada.</span>
    <span class="c1">// SEMPRE prefira esse m√©todo ao GetSection para evitar bugs desagrad√°veis!</span>
    <span class="kt">var</span> <span class="n">method2</span> <span class="p">=</span> <span class="n">Configuration</span><span class="p">.</span><span class="nf">GetRequiredSection</span><span class="p">(</span><span class="err">‚Äú</span><span class="n">Features</span><span class="err">‚Äù</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">method2</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">public</span> <span class="kt">bool</span> <span class="nf">GetEnableNewUI</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">Configuration</span><span class="p">.</span><span class="n">GetValue</span><span class="p">&lt;</span><span class="kt">bool</span><span class="p">&gt;(</span><span class="err">‚Äú</span><span class="n">Features</span><span class="p">:</span><span class="n">EnableNewUI</span><span class="err">‚Äù</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>A <code class="language-plaintext highlighter-rouge">IConfigurationSection</code> fornece a mesma API que a <code class="language-plaintext highlighter-rouge">IConfiguration</code>, portanto, voc√™ pode chamar <code class="language-plaintext highlighter-rouge">featuresSection.GetValue&lt;bool&gt;(‚ÄúEnableNewUI‚Äù)</code> para obter o valor dessa se√ß√£o. Tamb√©m √© poss√≠vel acessar diretamente um valor de configura√ß√£o que existe dentro de uma se√ß√£o usando um <code class="language-plaintext highlighter-rouge">:</code>, que pode ser visto em uso no m√©todo <code class="language-plaintext highlighter-rouge">GetEnableNewUI</code>.</p>

<div class="callout callout-info">
  <div class="callout-title">
    <span class="callout-icon">‚ÑπÔ∏è</span>
    Info
  </div>
  <div class="callout-content">
    
<p>Os dados estruturados n√£o se limitam aos arquivos JSON. Todos os provedores s√£o compat√≠veis com eles, embora a sintaxe para especificar uma se√ß√£o possa ser diferente. Por exemplo, para fornecer um valor para <code class="language-plaintext highlighter-rouge">EnableNewUI</code> usando uma vari√°vel de ambiente, voc√™ ter√° que criar uma chamada <code class="language-plaintext highlighter-rouge">Features__EnableNewUI</code>.</p>

  </div>
</div>

<h3 id="como-tudo-isso-funciona">Como tudo isso funciona?</h3>

<p>Estamos usando <code class="language-plaintext highlighter-rouge">IConfiguration</code> em alguns exemplos. Voc√™ deve estar se perguntando como tudo isso funciona nos bastidores; como criar uma inst√¢ncia de <code class="language-plaintext highlighter-rouge">IConfiguration</code> e como configur√°-la? Vamos dar uma olhada!</p>

<p>Para criar uma inst√¢ncia de <code class="language-plaintext highlighter-rouge">IConfiguration</code>, voc√™ precisar√° usar a classe <code class="language-plaintext highlighter-rouge">ConfigurationBuilder</code> (ou outra classe que implemente <code class="language-plaintext highlighter-rouge">IConfigurationBuilder</code>). Essa classe usa o padr√£o Builder para que voc√™ possa adicionar v√°rios provedores. No final, voc√™ chama <code class="language-plaintext highlighter-rouge">Build()</code> e acaba com um <code class="language-plaintext highlighter-rouge">IConfigurationRoot</code>. √â a mesma coisa que <code class="language-plaintext highlighter-rouge">IConfiguration</code>, mas tamb√©m tem uma lista de todos os provedores que voc√™ adicionou. Voc√™ nunca deve usar o <code class="language-plaintext highlighter-rouge">IConfigurationRoot</code> diretamente, pois n√£o deve acessar os provedores por baixo do pano. Um exemplo:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="kt">var</span> <span class="n">builder</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ConfigurationBuilder</span><span class="p">();</span>

<span class="n">builder</span><span class="p">.</span><span class="nf">AddJsonFile</span><span class="p">(</span><span class="err">‚Äú</span><span class="n">sharedsettings</span><span class="p">.</span><span class="n">json</span><span class="err">‚Äù</span><span class="p">);</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">AddJsonFile</span><span class="p">(</span><span class="err">‚Äú</span><span class="n">appsettings</span><span class="p">.</span><span class="n">json</span><span class="err">‚Äù</span><span class="p">);</span>
<span class="n">builder</span><span class="p">.</span><span class="nf">AddEnvironmentVariables</span><span class="p">();</span>
<span class="c1">// E assim por diante...</span>

<span class="n">IConfigurationRoot</span> <span class="n">configuration</span> <span class="p">=</span> <span class="n">builder</span><span class="p">.</span><span class="nf">Build</span><span class="p">();</span></code></pre></figure>

<p>A ordem desses provedores √© muito importante porque se trata de um sistema em camadas. D√™ uma olhada na imagem a seguir:</p>

<p><img src="/img/configuracao-dotnet/configuration-providers-layers.webp" alt="Uma imagem que mostra a import√¢ncia da ordem dos provedores de configura√ß√£o" /></p>

<p>Uma vis√£o geral da import√¢ncia da ordem dos provedores de configura√ß√£o.<br />
<a href="https://www.manning.com/books/asp-net-core-in-action-second-edition">ASP.NET Core in Action, Second Edition (Permiss√£o concedida pelo autor Andrew Lock)</a></p>

<p>Imagine que <code class="language-plaintext highlighter-rouge">sharedsettings.json</code> tenha um valor para todos os valores de configura√ß√£o usados pelo aplicativo. O <code class="language-plaintext highlighter-rouge">appsettings.json</code> e as <code class="language-plaintext highlighter-rouge">Vari√°veis de ambiente</code> cont√™m um subconjunto desses valores. Como o provedor para as vari√°veis de ambiente foi adicionado por √∫ltimo, ele tem a prioridade mais alta. Portanto, se voc√™ quiser recuperar um valor de configura√ß√£o chamado <code class="language-plaintext highlighter-rouge">ApiKey</code>, o sistema examinar√° primeiro as vari√°veis de ambiente. Se ele existir, ser√° retornado, mesmo que outros provedores tamb√©m contenham um valor para <code class="language-plaintext highlighter-rouge">ApiKey</code>. No entanto, se as vari√°veis de ambiente n√£o contiverem um valor para <code class="language-plaintext highlighter-rouge">ApiKey</code>, ele passar√° para o provedor que foi adicionado antes dele e pesquisar√° l√°, e assim por diante.</p>

<h4 id="os-valores-default">Os valores default</h4>

<p>Talvez voc√™ esteja um pouco confuso neste ponto. Eu certamente estava quando aprendi sobre o <code class="language-plaintext highlighter-rouge">IConfigurationBuilder</code> e a import√¢ncia dessas camadas. Por qu√™? Bem, percebi que estava usando o <code class="language-plaintext highlighter-rouge">IConfiguration</code> em muitos projetos, mas nunca tinha ouvido falar do <code class="language-plaintext highlighter-rouge">IConfigurationBuilder</code> antes. Ent√£o, como eu poderia estar usando o <code class="language-plaintext highlighter-rouge">IConfiguration</code>?</p>

<p>Isso funciona porque, se voc√™ trabalhar em um aplicativo .NET que <a href="https://learn.microsoft.com/dotnet/core/extensions/generic-host?WT.mc_id=DT-MVP-5005050">usa um Host</a>, ele definir√° todo um sistema de configura√ß√£o para voc√™ por padr√£o! Por exemplo, <a href="https://learn.microsoft.com/aspnet/core/fundamentals/host/generic-host?WT.mc_id=DT-MVP-5005050">projetos ASP.NET Core</a> e <a href="https://learn.microsoft.com/dotnet/core/extensions/workers?WT.mc_id=DT-MVP-5005050#worker-service-template">workers services</a> usam um <code class="language-plaintext highlighter-rouge">Host</code>, portanto, na maioria dos projetos, isso ser√° feito para voc√™! Agora vamos dar uma olhada em como isso funciona.</p>

<p>Em um aplicativo ASP.NET Core padr√£o, o seguinte √© configurado para voc√™.</p>

<table>
  <thead>
    <tr>
      <th>Provedor</th>
      <th>Exemplo</th>
      <th>Notas</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>appsettings.json</td>
      <td>{ ‚ÄúKey‚Äù: ‚Äúdefault value‚Äù }</td>
      <td>¬†</td>
    </tr>
    <tr>
      <td>appsettings.{ENVIRONMENT}.json</td>
      <td>{ ‚ÄúKey‚Äù: ‚Äúdevelopment value‚Äù }</td>
      <td>¬†</td>
    </tr>
    <tr>
      <td>user secrets (desenvolvimento)</td>
      <td>dotnet user-secrets set ‚Äúkey‚Äù ‚Äúdevelopment value‚Äù</td>
      <td>Tamb√©m pode ser definido em IDEs. Mais sobre isso posteriormente.</td>
    </tr>
    <tr>
      <td>Vari√°veis de ambiente</td>
      <td>Powershell: setx key ‚Äúvalor do ambiente‚Äù <br /> Bash: export key=‚Äòvalor do ambiente‚Äô</td>
      <td>Tamb√©m pode ser definido em IDEs. Muito popular em implanta√ß√µes do Docker/Kubernetes.</td>
    </tr>
    <tr>
      <td>Argumentos da linha de comando</td>
      <td>dotnet run ‚Äìkey ‚Äúimportant value‚Äù</td>
      <td>Tamb√©m pode ser definido nos IDEs.</td>
    </tr>
  </tbody>
</table>

<p>O item no topo tem a prioridade mais baixa. Portanto, se voc√™ chamar <code class="language-plaintext highlighter-rouge">Configuration[‚Äúkey‚Äù]</code>, obter√° como resultado <code class="language-plaintext highlighter-rouge">important value</code>, mesmo que o User Secrets tamb√©m forne√ßa um valor.</p>

<div class="callout callout-info">
  <div class="callout-title">
    <span class="callout-icon">‚ÑπÔ∏è</span>
    Info
  </div>
  <div class="callout-content">
    
<p>O provedor User secrets s√≥ √© adicionado quando o <em>Environment</em> √© definido como <em>Development</em>. Os ambientes ser√£o tratados a seguir. Os user secrets s√£o tratados em profundidade <a href="#user-secrets">mais adiante</a>.</p>

  </div>
</div>

<p>O Visual Studio (e outros IDEs, como o JetBrains Rider) oferecem suporte √† configura√ß√£o de vari√°veis de ambiente/argumentos de linha de comando em seu IDE quando voc√™ acessa as propriedades do projeto. No entanto, aconselho <strong>contra</strong> o uso disso durante o desenvolvimento. Eu nunca uso vari√°veis de ambiente ou argumentos de linha de comando durante o desenvolvimento porque √© mais dif√≠cil edit√°-los do que simplesmente abrir um arquivo. Armazen√°-los em <code class="language-plaintext highlighter-rouge">appsettings.Development.json</code> (que ser√° abordado a seguir) √© mais conveniente para voc√™ e seus colegas.</p>

<h4 id="configura√ß√£o-e-ambientes">Configura√ß√£o e Ambientes</h4>

<p>O provedor <em>appsettings.{<strong>ENVIRONMENT</strong>}.json</em> √© um pouco diferente dos outros provedores. Isso ocorre porque ele depende do <a href="https://learn.microsoft.com/aspnet/core/fundamentals/environments?WT.mc_id=DT-MVP-5005050">ambiente do aplicativo</a>. O ambiente atual do aplicativo √© lido a partir do valor da vari√°vel de ambiente <code class="language-plaintext highlighter-rouge">DOTNET_ENVIRONMENT</code> ou <code class="language-plaintext highlighter-rouge">ASPNETCORE_ENVIRONMENT</code>. Se o seu projeto n√£o for um projeto ASP.NET Core, o aplicativo verificar√° apenas <code class="language-plaintext highlighter-rouge">DOTNET_ENVIRONMENT</code>. Os projetos ASP.NET Core retornam para <code class="language-plaintext highlighter-rouge">DOTNET_ENVIRONMENT</code> quando <code class="language-plaintext highlighter-rouge">ASPNETCORE_ENVIRONMENT</code> n√£o existe.</p>

<p>O ambiente ser√° considerado como <code class="language-plaintext highlighter-rouge">Production</code> quando essas vari√°veis de ambiente n√£o existirem.</p>

<p>Quando voc√™ cria um projeto ASP.NET Core, um arquivo chamado <code class="language-plaintext highlighter-rouge">launchSettings.json</code> ser√° criado na pasta <code class="language-plaintext highlighter-rouge">Properties</code>. Aqui, voc√™ pode ver que a vari√°vel de ambiente <code class="language-plaintext highlighter-rouge">ASPNETCORE_ENVIRONMENT</code> est√° definida como <code class="language-plaintext highlighter-rouge">Development</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  // Muitos outros detalhes foram removidos desse arquivo para fins de brevidade
  ‚Äú$schema": ‚Äúhttps://json.schemastore.org/launchsettings.json‚Äù,
  ‚Äúprofiles": {
    ‚ÄúMY_PROJECT": {
      ‚ÄúcommandName": ‚ÄúMY_PROJECT‚Äù,
      ‚ÄúapplicationUrl": ‚Äúhttps://localhost:7237;http://localhost:5292‚Äù,
      ‚ÄúenvironmentVariables": {
        ‚ÄúASPNETCORE_ENVIRONMENT": ‚ÄúDevelopment‚Äù
      }
    }
  }
}

</code></pre></div></div>

<p>O resultado do sistema de configura√ß√£o trabalhando em conjunto com o ambiente do aplicativo resulta em um recurso muito poderoso, pois permite que voc√™ crie arquivos de configura√ß√£o diferentes para cada ambiente.</p>

<p>Voc√™ pode armazenar valores padr√£o em <code class="language-plaintext highlighter-rouge">appsettings.json</code> e substitu√≠-los em <code class="language-plaintext highlighter-rouge">appsettings.Development.json</code>, <code class="language-plaintext highlighter-rouge">appsettings.Test.json</code>, <code class="language-plaintext highlighter-rouge">appsettings.Staging.json</code> e <code class="language-plaintext highlighter-rouge">appsettings.Production.json</code>.</p>

<p>Por exemplo, digamos que voc√™ tenha terminado o novo design de uma p√°gina de checkout de uma loja virtual. Ele ainda precisa ser testado e revisado por outras pessoas em um ambiente de teste, mas ainda n√£o deve entrar em produ√ß√£o. Esse parece ser um caso de uso perfeito para feature flags! Voc√™ poderia criar um feature flag chamado <code class="language-plaintext highlighter-rouge">EnableNewCheckoutUI</code> e defini-lo como <code class="language-plaintext highlighter-rouge">false</code> em <code class="language-plaintext highlighter-rouge">appsettings.json</code> como o valor padr√£o. Em seguida, voc√™ pode substituir esses valores em <code class="language-plaintext highlighter-rouge">appsettings.Development.json</code> e <code class="language-plaintext highlighter-rouge">appsettings.Test.json</code> para que eles sejam ativados somente l√°:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// appsettings.json
{
  ‚ÄúFeatureFlags": {
    ‚ÄúEnableNewCheckoutUI": false
  }
}

// appsettings.Development.json e appsettings.Test.json
{
  ‚ÄúFeatureFlags": {
    ‚ÄúEnableNewCheckoutUI": true
  }
}

</code></pre></div></div>

<p>Voc√™ n√£o est√° limitado aos nomes de ambiente mencionados acima; eles s√£o apenas os padr√µes que o .NET usa. Se quiser usar um nome diferente, configure a vari√°vel de ambiente <code class="language-plaintext highlighter-rouge">ASPNETCORE_ENVIRONMENT</code> com o nome de sua escolha e crie um arquivo <code class="language-plaintext highlighter-rouge">appsettings.ENV_NAME.json</code> correspondente. A √∫nica outra coisa que voc√™ precisa fazer √© garantir que o ambiente em que voc√™ executa seu aplicativo tenha <code class="language-plaintext highlighter-rouge">ASPNETCORE_ENVIRONMENT</code> ou <code class="language-plaintext highlighter-rouge">DOTNET_ENVIRONMENT</code> definido com o valor correto.</p>

<h3 id="tratando-a-configura√ß√£o-como-c√≥digo">Tratando a Configura√ß√£o Como C√≥digo</h3>

<p>Anteriormente, elogiei o sistema de configura√ß√£o do .NET e o <code class="language-plaintext highlighter-rouge">IConfiguration</code> por serem flex√≠veis e ricos em recursos. Falei sobre seu suporte a dados estruturados e sobre a recupera√ß√£o de valores de uma hierarquia de configura√ß√£o mais profunda. Mas voc√™ sabia que pode fazer muito mais com dados estruturados?</p>

<p>Digamos que nosso aplicativo se comunique com uma API externa usando HTTP. Para isso, precisamos de um <code class="language-plaintext highlighter-rouge">ApiUrl</code>, <code class="language-plaintext highlighter-rouge">ApiKey</code> e talvez queiramos configurar um <code class="language-plaintext highlighter-rouge">TimeoutInMilliseconds</code>. Do ponto de vista do c√≥digo, talvez queiramos armazenar esses valores em uma classe (ou <code class="language-plaintext highlighter-rouge">record</code>) porque eles pertencem um ao outro:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="k">public</span> <span class="k">class</span> <span class="nc">ExternalApiSettings</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">ApiUrl</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">ApiKey</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">TimeoutInMilliseconds</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Em seguida, ter√≠amos uma classe <code class="language-plaintext highlighter-rouge">ExternalApiClient</code> que usa a configura√ß√£o e a classe que acabamos de criar:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="k">public</span> <span class="k">class</span> <span class="nc">ExternalApiClient</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">IConfiguration</span> <span class="n">_configuration</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">Foo</span><span class="p">(</span><span class="n">IConfiguration</span> <span class="n">configuration</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_configuration</span> <span class="p">=</span> <span class="n">configuration</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">CallExternalApi</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">IConfigurationSection</span> <span class="n">externalApiSettingsSection</span> <span class="p">=</span> <span class="n">_configuration</span><span class="p">.</span><span class="nf">GetRequiredSection</span><span class="p">(</span><span class="err">‚Äú</span><span class="n">ExternalApiSettings</span><span class="err">‚Äù</span><span class="p">);</span>
        
        <span class="c1">// M√©todo 1 (Get&lt;TType&gt;() obt√©m os valores dessa se√ß√£o e os mapeia em uma nova inst√¢ncia da classe fornecida)</span>
        <span class="n">ExternalApiSettings</span> <span class="n">settings1</span> <span class="p">=</span> <span class="n">externalApiSettingsSection</span><span class="p">.</span><span class="n">Get</span><span class="p">&lt;</span><span class="n">ExternalApiSettings</span><span class="p">&gt;();</span> 

        <span class="c1">// M√©todo 2 (Bind() espera uma inst√¢ncia existente de um tipo e mapear√° os valores para essa inst√¢ncia existente)</span>
        <span class="n">ExternalApiSettings</span> <span class="n">settings2</span> <span class="p">=</span> <span class="k">new</span><span class="p">();</span>
        <span class="n">_configuration</span><span class="p">.</span><span class="nf">GetRequiredSection</span><span class="p">(</span><span class="err">‚Äú</span><span class="n">ExternalApiSettings</span><span class="err">‚Äù</span><span class="p">).</span><span class="nf">Bind</span><span class="p">(</span><span class="n">settings2</span><span class="p">);</span>

        <span class="c1">// Fa√ßa algo com essas configura√ß√µes aqui...</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Isso parece bem legal, certo? Em vez de realizar 3 chamadas para obter cada propriedade de configura√ß√£o relacionada √† API individualmente, podemos mape√°-las em um objeto fortemente tipado. Agora podemos tratar nossa configura√ß√£o como c√≥digo! Poder√≠amos at√© criar m√©todos em nossa classe <code class="language-plaintext highlighter-rouge">ExternalApiSettings</code> para torn√°-la ainda mais poderosa!</p>

<p>No entanto, h√° algumas desvantagens importantes nessa abordagem.</p>

<h4 id="desvantagens">Desvantagens</h4>

<ul>
  <li>A primeira desvantagem √© que o nosso <code class="language-plaintext highlighter-rouge">ExternalApiClient</code> requer uma inst√¢ncia de <code class="language-plaintext highlighter-rouge">IConfiguration</code> para funcionar. Essa √© uma depend√™ncia muito grande e um grande desperd√≠cio, considerando que ele usa apenas 3 valores de configura√ß√£o! Al√©m disso, essa classe agora pode acessar outros valores de configura√ß√£o, como uma string de conex√£o a um banco de dados, configura√ß√µes de registro, feature flags etc., mesmo que n√£o precise dessas informa√ß√µes.</li>
  <li>A segunda desvantagem √© que essa classe est√° violando o princ√≠pio da responsabilidade √∫nica. Ela n√£o √© respons√°vel apenas por chamar a API externa, mas tamb√©m por interagir com o sistema de configura√ß√£o para poder chamar essa API externa.</li>
  <li>Como essa classe interage diretamente com o sistema de configura√ß√£o, ela depende de sua estrutura e, portanto, est√° fortemente acoplada. Qualquer altera√ß√£o na se√ß√£o de configura√ß√£o <code class="language-plaintext highlighter-rouge">ExternalApiSettings</code> (como o nome ou os nomes de seus filhos) causaria problemas em tempo de execu√ß√£o.</li>
</ul>

<p>Ent√£o, o que podemos fazer em rela√ß√£o a isso? Reescrev√™-la em Rust ü¶Ä? N√£o, podemos usar o options pattern!</p>

<h2 id="options-pattern">Options Pattern</h2>

<p>O <em>options pattern</em> (‚Äúpadr√£o de op√ß√µes‚Äù) permite que voc√™ fa√ßa um uso ainda melhor do sistema de configura√ß√£o do .NET üöÄ! Ele permite a voc√™ desacoplar seu aplicativo do sistema de configura√ß√£o e adiciona muitos recursos poderosos a esse sistema, como:</p>

<ul>
  <li>Inje√ß√£o de depend√™ncia</li>
  <li>Valida√ß√£o</li>
  <li>Diferentes tempos de vida de configura√ß√£o</li>
  <li>E muito mais!</li>
</ul>

<p>Para come√ßar a usar o options pattern de forma eficaz, √© necess√°rio criar classes/records das suas se√ß√µes de configura√ß√£o. J√° fizemos isso no exemplo anterior, portanto, vamos continuar com ele:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="k">public</span> <span class="k">class</span> <span class="nc">ExternalApiSettings</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">ApiUrl</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">ApiKey</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">TimeoutInMilliseconds</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<h3 id="inje√ß√£o-de-depend√™ncia">Inje√ß√£o de depend√™ncia</h3>

<p>O options pattern funciona muito bem com a inje√ß√£o de depend√™ncia! Para isso, basta registrar sua classe/record de op√ß√µes na cole√ß√£o de servi√ßos. Dependendo do seu projeto, o ponto de entrada para isso pode ser o m√©todo <code class="language-plaintext highlighter-rouge">Startup.cs -&gt; ConfigureServices(IServiceCollection services)</code> ou em algum lugar em seu <code class="language-plaintext highlighter-rouge">Program.cs</code>.</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="n">services</span><span class="p">.</span><span class="n">Configure</span><span class="p">&lt;</span><span class="n">ExternalApiSettings</span><span class="p">&gt;(</span><span class="n">configuration</span><span class="p">);</span> <span class="c1">// Passe em uma inst√¢ncia existente de IConfiguration</span></code></pre></figure>

<p>Isso adicionar√° uma inst√¢ncia de <code class="language-plaintext highlighter-rouge">IOptions&lt;ExternalApiSettings&gt;</code> ao seu cont√™iner de inje√ß√£o de depend√™ncia. Para ver os benef√≠cios dessa abordagem, vamos dar uma olhada em como poder√≠amos melhorar nosso <code class="language-plaintext highlighter-rouge">ExternalApiClient</code> de antes:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="k">public</span> <span class="k">class</span> <span class="nc">ExternalApiClient</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">ExternalApiSettings</span> <span class="n">_externalApiSettings</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">ExternalApiClient</span><span class="p">(</span><span class="n">IOptions</span><span class="p">&lt;</span><span class="n">ExternalApiSettings</span><span class="p">&gt;</span> <span class="n">options</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Importante: o padr√£o Options √© ‚Äúpregui√ßoso‚Äù. Isso significa que as op√ß√µes s√£o mapeadas somente quando voc√™ as solicita chamando .Value!</span>
        <span class="c1">// Isso √© feito apenas uma vez, portanto, voc√™ n√£o precisa se preocupar com o desempenho.</span>
        <span class="n">_externalApiSettings</span> <span class="p">=</span> <span class="n">options</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">CallExternalApi</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Faz algo com essas configura√ß√µes aqui...</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Isso eliminou todas as desvantagens de antes! Nosso <code class="language-plaintext highlighter-rouge">ExternalApiClient</code> n√£o tem mais uma depend√™ncia do <code class="language-plaintext highlighter-rouge">IConfiguration</code> e n√£o est√° mais acoplado ao sistema de configura√ß√£o. Ele tamb√©m n√£o precisa mais se preocupar com a estrutura do sistema de configura√ß√£o.</p>

<p>Voc√™ pode argumentar que temos uma depend√™ncia indireta do sistema de configura√ß√£o por causa da chamada <code class="language-plaintext highlighter-rouge">.Configure&lt;&gt;(configuration)</code> de antes, mas voc√™ n√£o √© obrigado a usar esse m√©todo para configurar suas op√ß√µes. Voc√™ pode criar uma inst√¢ncia de <code class="language-plaintext highlighter-rouge">IOptions&lt;T&gt;</code> usando <code class="language-plaintext highlighter-rouge">Microsoft.Extensions.Options.Options.Create()</code> se precisar criar uma inst√¢ncia manualmente, e pode passar quaisquer dados que desejar. Voc√™ pode at√© mesmo criar op√ß√µes com base em outras depend√™ncias usando o m√©todo <code class="language-plaintext highlighter-rouge">Configure&lt;TDep1,...&gt;()</code> do <code class="language-plaintext highlighter-rouge">OptionsBuilder</code>, que ser√° discutido a seguir.</p>

<div class="callout callout-info">
  <div class="callout-title">
    <span class="callout-icon">‚ÑπÔ∏è</span>
    Info
  </div>
  <div class="callout-content">
    
<p>Talvez voc√™ se pergunte por que precisamos envolver nossa classe de configura√ß√µes com uma interface <code class="language-plaintext highlighter-rouge">IOptions&lt;&gt;</code>. Isso ocorre porque ela permite que voc√™ use alguns recursos mais avan√ßados sobre os quais falaremos a seguir.</p>

  </div>
</div>

<h3 id="valida√ß√£o">Valida√ß√£o</h3>

<p>Meu recurso favorito do sistema de configura√ß√£o do .NET √© a facilidade com que √© poss√≠vel validar sua configura√ß√£o! Acredito que essa seja uma das partes mais importantes de qualquer aplicativo, e n√£o vejo que ela seja usada com frequ√™ncia. O motivo pelo qual acredito que a configura√ß√£o √© uma das partes mais importantes de qualquer aplicativo √© porque ela abriga defini√ß√µes muito importantes do seu aplicativo.</p>

<p>Um aplicativo configurado incorretamente pode ter resultados desastrosos. Na pior das hip√≥teses, imagine que o seu ambiente de teste esteja se conectando acidentalmente aos recursos do ambiente de produ√ß√£o. Agora imagine que voc√™ testaria uma fun√ß√£o de exclus√£o em massa e acidentalmente excluiria todos os seus dados de produ√ß√£o. Isso seria um desastre!</p>

<p>√â por isso que queremos validar nossa configura√ß√£o. Se o nosso aplicativo for iniciado com um sistema de configura√ß√£o incorreto, queremos sair imediatamente.</p>

<p>Ent√£o, como configuramos isso? √â mais f√°cil do que voc√™ imagina. Eu gosto de usar <a href="https://www.infoworld.com/article/3543302/how-to-use-data-annotations-in-c-sharp.html">Data Annotations</a> para minhas valida√ß√µes de op√ß√µes quando n√£o preciso de regras de valida√ß√£o complexas, portanto, vamos modificar nosso <code class="language-plaintext highlighter-rouge">ExternalApiSettings</code> desta forma:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="k">public</span> <span class="k">class</span> <span class="nc">ExternalApiSettings</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">Required</span><span class="p">]</span> <span class="c1">// Se o ApiUrl n√£o estiver definido, a configura√ß√£o √© inv√°lida</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">ApiUrl</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">[</span><span class="n">Required</span><span class="p">]</span> <span class="c1">// Se a ApiKey n√£o for definida, a configura√ß√£o ser√° inv√°lida</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">ApiKey</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">[</span><span class="nf">Range</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="n">_000_00</span><span class="p">)]</span> <span class="c1">// Se o TimeoutInMilliseconds n√£o for definido (o padr√£o √© 0) ou for maior que 100000, a configura√ß√£o ser√° inv√°lida</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">TimeoutInMilliseconds</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Agora, vamos alterar a forma como registramos essas op√ß√µes no cont√™iner de inje√ß√£o de depend√™ncia:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="n">services</span>
    <span class="p">.</span><span class="n">AddOptions</span><span class="p">&lt;</span><span class="n">ExternalApiSettings</span><span class="p">&gt;()</span>
    <span class="p">.</span><span class="nf">BindConfiguration</span><span class="p">(</span><span class="err">‚Äú</span><span class="n">ExternalApiSettings</span><span class="err">‚Äù</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">ValidateDataAnnotations</span><span class="p">()</span> <span class="c1">// Lan√ßa uma OptionsValidationException se a configura√ß√£o for inv√°lida</span>
    <span class="p">.</span><span class="nf">ValidateOnStart</span><span class="p">();</span> <span class="c1">// Altamente recomendado!</span></code></pre></figure>

<p>Em vez de usar <code class="language-plaintext highlighter-rouge">Configure&lt;TType&gt;(configuration)</code>, agora usamos <code class="language-plaintext highlighter-rouge">AddOptions&lt;TType&gt;()</code>. Isso retorna um <code class="language-plaintext highlighter-rouge">OptionsBuilder</code> e nos permite usar alguns m√©todos poderosos.</p>

<ol>
  <li>O primeiro que usamos √© o <code class="language-plaintext highlighter-rouge">BindConfiguration()</code>. Esse m√©todo recupera o <code class="language-plaintext highlighter-rouge">IConfiguration</code> do cont√™iner de inje√ß√£o de depend√™ncia e vincula a se√ß√£o que passamos. Isso √© √∫til porque n√£o precisamos mais passar manualmente nossa configura√ß√£o.</li>
  <li>Em seguida, chamamos <code class="language-plaintext highlighter-rouge">ValidateDataAnnotations()</code>. Isso validar√° nossa se√ß√£o de configura√ß√£o com base nos atributos que definimos nas propriedades.
    <ol>
      <li>Observa√ß√£o: voc√™ precisa instalar o pacote nuget <a href="https://www.nuget.org/packages/Microsoft.Extensions.Options.DataAnnotations">Microsoft.Extensions.Options.DataAnnotations</a> se n√£o tiver esse m√©todo dispon√≠vel.</li>
    </ol>
  </li>
  <li>Por fim, chamamos <code class="language-plaintext highlighter-rouge">ValidateOnStart()</code>. Essa etapa √© <strong>muito</strong> importante! Por padr√£o, suas op√ß√µes s√≥ ser√£o validadas quando voc√™ chamar <code class="language-plaintext highlighter-rouge">.Value</code> nelas em algum lugar, como em uma classe onde elas s√£o injetadas. Isso significa que seu aplicativo N√ÉO lan√ßaria um erro e sairia na inicializa√ß√£o quando sua configura√ß√£o fosse inv√°lida! O <code class="language-plaintext highlighter-rouge">ValidateOnStart()</code> validar√° sua configura√ß√£o depois que o aplicativo terminar de se inicializar.</li>
</ol>

<p>Voc√™ tamb√©m pode validar seu c√≥digo de muitas outras maneiras. Voc√™ pode usar a interface <code class="language-plaintext highlighter-rouge">IValidatableOptions&lt;&gt;</code> para implementar uma l√≥gica de valida√ß√£o complexa ou pode chamar <code class="language-plaintext highlighter-rouge">Validate(Func&lt;TOptions, bool&gt; validation)</code> para escrever uma l√≥gica de valida√ß√£o personalizada como parte do construtor de op√ß√µes. Voc√™ pode at√© mesmo <a href="https://andrewlock.net/adding-validation-to-strongly-typed-configuration-objects-using-flentvalidation/">integr√°-lo ao FluentValidation</a>!</p>

<h3 id="tempos-de-vida-da-configura√ß√£o">Tempos de vida da configura√ß√£o</h3>

<p>Por fim, gostaria de falar sobre o tempo de vida do padr√£o Options. O <code class="language-plaintext highlighter-rouge">IOptions&lt;T&gt;</code> √© um singleton. Isso significa que, se um de seus <a href="https://learn.microsoft.com/dotnet/core/extensions/configuration-providers?WT.mc_id=DT-MVP-5005050#json-configuration-provider">provedores de configura√ß√£o for atualizado em tempo de execu√ß√£o</a>, as op√ß√µes n√£o ser√£o atualizadas. Isso ocorre porque as op√ß√µes s√£o mapeadas apenas uma vez quando voc√™ chama <code class="language-plaintext highlighter-rouge">.Value</code> sobre elas.</p>

<p>Isso pode ser considerado positivo, pois significa que seu aplicativo n√£o mudar√° repentinamente de comportamento quando a configura√ß√£o for alterada. No entanto, voc√™ tamb√©m pode dizer que isso √© ruim porque talvez n√£o queira ter que fazer deploy ou reiniciar o aplicativo quando alterar a configura√ß√£o. Nesse caso, √© melhor usar <code class="language-plaintext highlighter-rouge">IOptionsSnapshot&lt;T&gt;</code> ou <code class="language-plaintext highlighter-rouge">IOptionsMonitor&lt;T&gt;</code>.</p>

<p><img src="/img/configuracao-dotnet/options-lifetimes.webp" alt="Vis√£o geral dos recursos de IOptions, IOptionsSnapshot e IOptionsMonitor" /></p>

<p>Vis√£o geral dos recursos de IOptions, IOptionsSnapshot e IOptionsMonitor</p>

<h4 id="ioptionssnapshot">IOptionsSnapshot</h4>

<p>Em vez de injetar <code class="language-plaintext highlighter-rouge">IOptions&lt;T&gt;</code> em uma de suas classes, voc√™ pode injetar <code class="language-plaintext highlighter-rouge">IOptionsSnapshot&lt;T&gt;</code>. Isso recarregar√° esse tipo espec√≠fico de op√ß√µes a cada <a href="https://learn.microsoft.com/dotnet/core/extensions/dependency-injection?WT.mc_id=DT-MVP-5005050#scoped">scope</a>. Um escopo no .NET √© um termo abstrato. Um escopo pode ser uma solicita√ß√£o HTTP, por exemplo. Portanto, para cada solicita√ß√£o HTTP, ele recarregaria as op√ß√µes e elas permaneceriam consistentes para toda a solicita√ß√£o. Isso significa que, se voc√™ alterar sua configura√ß√£o, ela s√≥ ser√° atualizada em uma nova solicita√ß√£o.</p>

<div class="callout callout-warning">
  <div class="callout-title">
    <span class="callout-icon">‚ö†Ô∏è</span>
    Aviso
  </div>
  <div class="callout-content">
    
<p>Usar <code class="language-plaintext highlighter-rouge">IOptionsSnapshot&lt;T&gt;</code> pode causar <a href="https://github.com/dotnet/runtime/issues/53793">desempenho ruim.</a></p>

  </div>
</div>

<h4 id="ioptionsmonitor">IOptionsMonitor</h4>

<p>O <code class="language-plaintext highlighter-rouge">IOptionsMonitor&lt;T&gt;</code> n√£o funciona com escopos. Em vez disso, voc√™ precisa chamar <code class="language-plaintext highlighter-rouge">.CurrentValue</code> (em vez de <code class="language-plaintext highlighter-rouge">.Value</code>) para recuperar a vers√£o atual. No entanto, √© preciso ter cuidado com a forma como voc√™ acessa a sua configura√ß√£o! Imagine um cen√°rio em que sua configura√ß√£o √© alterada no meio de uma solicita√ß√£o HTTP. Chamar <code class="language-plaintext highlighter-rouge">.CurrentValue</code> no in√≠cio e no final de uma solicita√ß√£o resultaria em valores diferentes, o que cria um risco de sincroniza√ß√£o. Voc√™ pode registrar uma chamada de retorno usando <code class="language-plaintext highlighter-rouge">OnChange()</code> para ser notificado sobre esses eventos.</p>

<p>Essa interface √© mais √∫til em um cen√°rio de trabalho em segundo plano que √© instanciado apenas uma vez, mas que se beneficiaria da capacidade de lidar com altera√ß√µes de configura√ß√£o.</p>

<h2 id="gerenciamento-de-segredos-durante-o-desenvolvimento">Gerenciamento de segredos durante o desenvolvimento</h2>

<p>Se voc√™ vai tirar alguma conclus√£o dEste post, que seja a seguinte:</p>

<div class="callout callout-error">
  <div class="callout-title">
    <span class="callout-icon">‚ùå</span>
    Importante
  </div>
  <div class="callout-content">
    
<p>Nunca armazene segredos em seu reposit√≥rio git! Considere o uso de uma ferramenta de verifica√ß√£o de c√≥digo como <a href="https://docs.github.com/en/enterprise-cloud@latest/get-started/learning-about-github/about-github-advanced-security">GitHub Advanced Security</a>, <a href="https://azure.microsoft.com/products/devops/github-advanced-security?WT.mc_id=DT-MVP-5005050">GitHub Advanced Security for Azure DevOps</a> ou <a href="https://www.gitguardian.com/">GitGuardian</a> para evitar que segredos sejam vazados.</p>

  </div>
</div>

<p>Se voc√™ armazenar segredos em seu reposit√≥rio git e o reposit√≥rio for comprometido, seus segredos tamb√©m ser√£o comprometidos. Acho que n√£o preciso explicar por que isso √© ruim. Ent√£o, como podemos evitar que isso aconte√ßa com o .NET?</p>

<p>Usando o provedor de configura√ß√£o de user secrets (segredos de usu√°rio).</p>

<h3 id="o-provedor-de-configura√ß√£o-de-user-secrets">O provedor de configura√ß√£o de user secrets</h3>

<p>Mencionei o provedor de configura√ß√£o de user secrets <a href="#os-valores-default">anteriormente</a>. Esse provedor de configura√ß√£o foi criado para desenvolvimento local <em>somente</em>. Ele permite que voc√™ armazene segredos em seu computador local sem precisar se preocupar com o risco de eles serem versionados no reposit√≥rio git, pois s√£o armazenados em um local diferente:</p>

<ul>
  <li>Windows: <code class="language-plaintext highlighter-rouge">%APPDATA%\Microsoft\UserSecrets\&lt;user_secrets_id&gt;\secrets.json</code></li>
  <li>Mac e Linux: <code class="language-plaintext highlighter-rouge">~/.microsoft/usersecrets/&lt;user_secrets_id&gt;/secrets.json</code></li>
</ul>

<p>Esse arquivo √© muito semelhante ao provedor <code class="language-plaintext highlighter-rouge">appsettings.json</code>. Basta inserir JSON nele e voc√™ poder√° acess√°-lo com o sistema de configura√ß√£o do .NET. Quando seu aplicativo for iniciado e sua vari√°vel de ambiente <code class="language-plaintext highlighter-rouge">ASPNETCORE_ENVIRONMENT</code> ou <code class="language-plaintext highlighter-rouge">DOTNET_ENVIRONMENT</code> estiver definida como <code class="language-plaintext highlighter-rouge">Development</code>, ele carregar√° automaticamente o provedor de configura√ß√£o de user secrets <em>desde que seu projeto esteja configurado para usar esse provedor</em>.</p>

<div class="callout callout-warning">
  <div class="callout-title">
    <span class="callout-icon">‚ö†Ô∏è</span>
    Aviso
  </div>
  <div class="callout-content">
    
<p>Mesmo que esse provedor tenha o nome ‚Äúsecret‚Äù, esteja avisado! O conte√∫do do arquivo <code class="language-plaintext highlighter-rouge">secrets.json</code> n√£o √© criptografado. Se voc√™ trabalha em um ambiente em que armazenar segredos na pr√≥pria m√°quina √© arriscado, considere usar <a href="#using-the-key-vault-during-local-development">um armazenamento de segredos externo como o Azure KeyVault durante o desenvolvimento</a>.</p>

  </div>
</div>

<p>Esse provedor de configura√ß√£o pode ser acessado usando a CLI ou seu IDE favorito. Talvez seja necess√°rio instalar o pacote <a href="https://www.nuget.org/packages/Microsoft.Extensions.Configuration.UserSecrets">Microsoft.Extensions.Configuration.UserSecrets</a> caso voc√™ n√£o use um <code class="language-plaintext highlighter-rouge">Host</code> ou tenha uma configura√ß√£o personalizada.</p>

<h3 id="usando-user-secrets">Usando User Secrets</h3>

<h4 id="cli">CLI</h4>

<p>Voc√™ pode usar o <code class="language-plaintext highlighter-rouge">dotnet</code> cli para interagir com user-secrets abrindo um terminal no diret√≥rio em que reside o <code class="language-plaintext highlighter-rouge">*.csproj</code> do seu projeto.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Necess√°rio apenas quando as user-secrets ainda n√£o foram inicializadas
dotnet user-secrets init

# Voc√™ pode usar dados estruturados usando dois pontos (:) para separar as chaves
dotnet user-secrets set ‚ÄúConnectionStrings:Database‚Äù ‚ÄúData Source=...‚Äù
dotnet user-secrets set ‚ÄúAdminPassword‚Äù ‚Äúhunter2‚Äù
# Outros comandos como ‚Äúlist‚Äù, ‚Äúremove‚Äù e ‚Äúclear‚Äù tamb√©m est√£o dispon√≠veis

</code></pre></div></div>

<h4 id="visual-studio">Visual Studio</h4>

<p>Clique com o bot√£o direito do mouse em um projeto no Solution Explorer e selecione <code class="language-plaintext highlighter-rouge">Manage User Secrets</code>. Um arquivo <code class="language-plaintext highlighter-rouge">secrets.json</code> ser√° aberto, no qual voc√™ poder√° inserir seus segredos.</p>

<h4 id="visual-studio-code">Visual Studio Code</h4>

<p>Instale a extens√£o <a href="https://marketplace.visualstudio.com/items?itemName=adrianwilczynski.user-secrets">.NET Core User Secrets Visual Studio Code</a>. Em seguida, voc√™ pode clicar com o bot√£o direito do mouse em um arquivo <code class="language-plaintext highlighter-rouge">*.csproj</code> e selecionar <code class="language-plaintext highlighter-rouge">Manage User Secrets</code>. Um arquivo <code class="language-plaintext highlighter-rouge">secrets.json</code> ser√° aberto, no qual voc√™ poder√° inserir seus segredos.</p>

<h4 id="jetbrains-rider">JetBrains Rider</h4>

<p>Clique com o bot√£o direito do mouse em um projeto no Solution Explorer e selecione <code class="language-plaintext highlighter-rouge">Tools</code> &gt; <code class="language-plaintext highlighter-rouge">Manage User Secrets</code>. Um arquivo <code class="language-plaintext highlighter-rouge">secrets.json</code> ser√° aberto, no qual voc√™ poder√° inserir seus segredos.</p>

<h3 id="configurando-um-projeto-que-usa-user-secrets">Configurando um projeto que usa user-secrets</h3>

<p>Uma desvantagem de usar segredos de usu√°rio durante o desenvolvimento √© que, se o seu projeto exigir alguns segredos para ser executado, ser√° necess√°rio executar algumas etapas de configura√ß√£o ap√≥s a clonagem do projeto. Tenho duas recomenda√ß√µes para lidar com isso:</p>

<ul>
  <li>Voc√™ pode criar um script que recupere os segredos do seu local de armazenamento de segredos e, em seguida, armazene-os em user-secrets, canalizando esses valores para <code class="language-plaintext highlighter-rouge">dotnet user-secrets set</code>. Agora voc√™ s√≥ precisa executar esse script uma vez ap√≥s clonar o projeto e pronto!</li>
  <li>Como alternativa, recomendo atualizar seu <code class="language-plaintext highlighter-rouge">README.MD</code> incluindo instru√ß√µes de configura√ß√£o que informem ao usu√°rio quais user-secrets devem ser definidos e de onde obter esses valores. Sinta-se √† vontade para criar um link para Este post se quiser explicar o que s√£o user-secrets üòâ.</li>
</ul>

<h2 id="meu-modelo-para-gerenciamento-de-configura√ß√£o">Meu modelo para gerenciamento de configura√ß√£o</h2>

<p>Agora que abordamos os conceitos b√°sicos e o uso avan√ßado do sistema de configura√ß√£o do .NET e como incorporar o gerenciamento de segredos locais, gostaria de mostrar minha ‚Äúconfigura√ß√£o‚Äù para o gerenciamento de configura√ß√£o em um projeto .NET. Quando crio um novo projeto .NET, uso a seguinte configura√ß√£o:</p>

<h3 id="appsettingsjson">appsettings.json</h3>

<p>O sistema de configura√ß√£o do .NET permite que voc√™ seja muito flex√≠vel com todos os diferentes provedores. Isso √© √≥timo, mas tamb√©m pode causar confus√£o quando seu aplicativo estiver usando valores de configura√ß√£o que voc√™ n√£o esperava ou quando n√£o conseguir descobrir de onde vem um valor de configura√ß√£o espec√≠fico.</p>

<div class="callout callout-tip">
  <div class="callout-title">
    <span class="callout-icon">üí°</span>
    Dica
  </div>
  <div class="callout-content">
    
<p>Use o m√©todo <code class="language-plaintext highlighter-rouge">IConfigurationRoot.GetDebugView()</code> quando estiver tendo problemas com os valores de configura√ß√£o. Para fazer isso, obtenha uma inst√¢ncia <code class="language-plaintext highlighter-rouge">IConfiguration</code>, converta-a em <code class="language-plaintext highlighter-rouge">IConfigurationRoot</code> e inspecione o resultado de <code class="language-plaintext highlighter-rouge">GetDebugView()</code>.</p>

<p>Para obter mais informa√ß√µes, consulte o <a href="https://andrewlock.net/debugging-configuration-values-in-aspnetcore/#exposing-the-debug-view-in-your-application">fant√°stico post de Andrew Lock</a> sobre isso.</p>

  </div>
</div>

<p>Eu uso <code class="language-plaintext highlighter-rouge">appsettings.json</code> para armazenar um modelo de todos os valores de configura√ß√£o que meu projeto usa e de onde os valores s√£o recuperados. Esse arquivo tamb√©m pode conter valores reais quando o arquivo <code class="language-plaintext highlighter-rouge">appsettings.json</code> √© o √∫nico provedor para esse valor de configura√ß√£o. Gosto muito dessa configura√ß√£o porque ela me permite ver todos os valores de configura√ß√£o que meu projeto usa em um s√≥ lugar.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  ‚ÄúLogging": {
    ‚ÄúLogLevel": {
      ‚ÄúDefault‚Äù (Padr√£o): ‚ÄúInforma√ß√µes‚Äù,
      ‚ÄúMicrosoft.AspNetCore": ‚ÄúWarning‚Äù
    }
  },

  ‚ÄúConnectionStrings": {
    ‚ÄúDatabase‚Äù: ‚Äú&lt;from-azure-keyvault&gt;‚Äù // O Azure Key Vault ser√° discutido na pr√≥xima se√ß√£o
  },

  ‚ÄúExternalApiSettings": {
    ‚ÄúApiUrl": ‚Äú&lt;from-environment-variables&gt;‚Äù,
    ‚ÄúApiKey": ‚Äú&lt;from-azure-keyvault&gt;‚Äù,
    ‚ÄúTimeoutInMilliseconds": 5000
  }
}

</code></pre></div></div>

<h3 id="appsettingsdevelopmentjson">appsettings.Development.json</h3>

<p>A seguir, temos o arquivo <code class="language-plaintext highlighter-rouge">appsettings.Development.json</code>. Esse arquivo pode conter valores de configura√ß√£o que substituem os valores do <code class="language-plaintext highlighter-rouge">appsettings.json</code>, como configura√ß√µes de registro. Al√©m disso, esse arquivo <strong>nunca</strong> deve conter segredos! Em vez disso, ele faz refer√™ncia ao provedor de configura√ß√£o de user secrets. Isso torna menos prov√°vel que as pessoas insiram segredos nesse arquivo, pois elas s√£o levadas a usar o provedor de configura√ß√£o de user secrets.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  ‚ÄúLogging": {
    ‚ÄúLogLevel": {
      ‚ÄúDefault‚Äù: ‚ÄúDebug‚Äù, // As configura√ß√µes de log s√£o 100% de prefer√™ncia pessoal, fique √† vontade para usar o que quiser
      ‚ÄúMicrosoft.AspNetCore": ‚ÄúWarning‚Äù
    }
  },

  ‚ÄúConnectionStrings": {
    ‚ÄúDatabase‚Äù: ‚Äú&lt;from-user-secrets&gt;‚Äù // Cada desenvolvedor pode usar sua pr√≥pria string de conex√£o de banco de dados local
  },

  ‚ÄúExternalApiSettings": {
    ‚ÄúApiUrl": ‚Äúdev.externalapi.example.com‚Äù,
    ‚ÄúApiKey": ‚Äú&lt;from-user-secrets&gt;‚Äù
    // N√£o forne√ßo um valor para TimeoutInMilliseconds porque n√£o tenho problemas com o valor de appsettings.json
  }
}

</code></pre></div></div>

<h3 id="user-secrets">User Secrets</h3>

<p>Por fim, uso o provedor de configura√ß√£o user secrets para armazenar segredos locais <em>e</em> substituir a configura√ß√£o n√£o secreta que n√£o quero enviar para o reposit√≥rio git, como alterar as configura√ß√µes de log no caso de precisar me aprofundar em um bug. Se eu alterasse esses valores de configura√ß√£o no arquivo <code class="language-plaintext highlighter-rouge">appsettings.Development.json</code>, teria que me lembrar de reverter essas altera√ß√µes antes de fazer o commit do meu c√≥digo. Ao usar o provedor de configura√ß√£o de user secrets, n√£o preciso me preocupar com isso.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  ‚ÄúLogging": {
    ‚ÄúLogLevel": {
      ‚ÄúMicrosoft.AspNetCore": ‚ÄúInformation‚Äù
    }
  },

  ‚ÄúConnectionStrings": {
    ‚ÄúDatabase‚Äù: ‚ÄúData Source=...‚Äù
  },

  ‚ÄúExternalApiSettings": {
    ‚ÄúApiKey": ‚Äúabc123def456ghi7‚Äù
  }
}

</code></pre></div></div>

<div class="callout callout-question">
  <div class="callout-title">
    <span class="callout-icon">‚ùì</span>
    Pergunta
  </div>
  <div class="callout-content">
    
<p>Como √© a sua configura√ß√£o? O que voc√™ acha da minha? Deixe sua opini√£o nos coment√°rios abaixo!</p>

  </div>
</div>

<h2 id="usando-o-azure-para-armazenar-a-configura√ß√£o">Usando o Azure para armazenar a configura√ß√£o</h2>

<p>Agora que sabemos como armazenar a configura√ß√£o e os segredos localmente, √© hora de falar sobre a execu√ß√£o de seus aplicativos em ambientes reais. H√° muitas maneiras diferentes de configurar a configura√ß√£o e o gerenciamento de segredos para ambientes n√£o locais, portanto, tudo se resume a conhecer as vantagens e desvantagens dessas abordagens e escolher o que funciona melhor para voc√™. Neste post, voc√™ aprender√° a usar o Azure para armazenar sua configura√ß√£o e seus segredos com seguran√ßa.</p>

<div class="callout callout-info">
  <div class="callout-title">
    <span class="callout-icon">‚ÑπÔ∏è</span>
    Info
  </div>
  <div class="callout-content">
    
<p>Embora esta se√ß√£o seja sobre o Azure, os conceitos tamb√©m se aplicam a outros provedores de nuvem. O equivalente do Azure App Configuration no AWS √© chamado de <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-parameter-store.html">AWS Systems Manager Parameter Store</a>. O Azure Key Vault tem um equivalente no AWS chamado <a href="https://aws.amazon.com/secrets-manager/">AWS Secrets Manager</a> e o equivalente do Google √© chamado <a href="https://cloud.google.com/secret-manager">Google Secret Manager</a>.</p>

<p>Se quiser hospedar seu gerenciamento de segredos por conta pr√≥pria, d√™ uma olhada em <a href="https://www.vaultproject.io/">Hashicorp Vault</a>.</p>


  </div>
</div>

<h3 id="armazenamento-de-segredos-no-azure-key-vault">Armazenamento de segredos no Azure Key Vault</h3>

<p>Como dissemos anteriormente, n√£o √© poss√≠vel usar o provedor de configura√ß√£o User Secrets em ambientes n√£o locais. Portanto, temos que encontrar uma maneira diferente de armazenar nossos segredos quando estivermos implantando nossos aplicativos. O <a href="https://azure.microsoft.com/services/key-vault/?WT.mc_id=DT-MVP-5005050">Azure Key Vault</a> √© um √≥timo servi√ßo para armazenar segredos, chaves e certificados de forma barata, f√°cil e segura.</p>

<p>No in√≠cio deste post, mencionei que √© poss√≠vel conectar o sistema de configura√ß√£o do .NET √† nuvem, o que <a href="https://learn.microsoft.com/aspnet/core/security/key-vault-configuration?WT.mc_id=DT-MVP-5005050">√© poss√≠vel com o Key Vault</a>. Essa √© uma √≥tima abordagem para o gerenciamento de segredos porque voc√™ pode simplesmente tratar o Key Vault como um provedor de configura√ß√£o e n√£o precisa mais fazer coisas complicadas no pipeline de lan√ßamento.</p>

<p>Para adicion√°-lo como um provedor de configura√ß√£o, instale os pacotes <a href="https://www.nuget.org/packages/Azure.Extensions.AspNetCore.Configuration.Secrets">Azure.Extensions.AspNetCore.Configuration.Secrets</a> e <a href="https://www.nuget.org/packages/Azure.Identity">Azure.Identity</a>. Em seguida, voc√™ s√≥ precisar√° adicionar algumas linhas de c√≥digo ao seu <code class="language-plaintext highlighter-rouge">Program.cs</code> quando criar uma API m√≠nima, por exemplo:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="k">using</span> <span class="nn">Azure.Identity</span><span class="p">;</span>

<span class="kt">var</span> <span class="n">builder</span> <span class="p">=</span> <span class="n">WebApplication</span><span class="p">.</span><span class="nf">CreateBuilder</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>

<span class="n">builder</span><span class="p">.</span><span class="n">Host</span><span class="p">.</span><span class="nf">ConfigureAppConfiguration</span><span class="p">((</span><span class="n">context</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">context</span><span class="p">.</span><span class="n">HostingEnvironment</span><span class="p">.</span><span class="nf">IsDevelopment</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">keyVaultUrl</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Uri</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="n">Configuration</span><span class="p">.</span><span class="n">GetValue</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;(</span><span class="err">‚Äú</span><span class="n">KeyVaultUrl</span><span class="err">‚Äù</span><span class="p">));</span>
        <span class="n">config</span><span class="p">.</span><span class="nf">AddAzureKeyVault</span><span class="p">(</span><span class="n">keyVaultUrl</span><span class="p">,</span> <span class="k">new</span> <span class="nf">ManagedIdentityCredential</span><span class="p">());</span> <span class="c1">// H√° outras op√ß√µes de credenciais dispon√≠veis. As Managed Identities ser√£o abordadas em breve!</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<p>O Key Vault agora √© adicionado como o provedor final e, portanto, tem <a href="#os-valores-default">a prioridade mais alta</a>. Portanto, mesmo que outros provedores tenham um valor configurado para um segredo, o Key Vault ser√° usado em seu lugar!</p>

<div class="callout callout-info">
  <div class="callout-title">
    <span class="callout-icon">‚ÑπÔ∏è</span>
    Info
  </div>
  <div class="callout-content">
    
<p>Os segredos estruturados devem ser armazenados no Key Vault com 2 tra√ßos (<code class="language-plaintext highlighter-rouge">--</code>) em vez de 2 sublinhados ou dois pontos devido a limita√ß√µes de nomenclatura. Por exemplo, <code class="language-plaintext highlighter-rouge">ExternalApiSettings--ApiKey</code> em vez de <code class="language-plaintext highlighter-rouge">ExternalApiSettings:ApiKey</code> ou <code class="language-plaintext highlighter-rouge">ExternalApiSettings__ApiKey</code>.</p>

  </div>
</div>

<h4 id="usando-o-key-vault-durante-o-desenvolvimento-local">Usando o Key Vault durante o desenvolvimento local</h4>

<p>Anteriormente neste post, mencionei brevemente que voc√™ pode estar em um cen√°rio em que n√£o √© poss√≠vel armazenar segredos em seu computador por motivos de seguran√ßa, por exemplo. Nesse caso, usar o Key Vault durante o desenvolvimento local resolveria esse problema. Voc√™ pode pegar o exemplo de c√≥digo da se√ß√£o anterior e modific√°-lo da seguinte forma:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="k">using</span> <span class="nn">Azure.Identity</span><span class="p">;</span>

<span class="kt">var</span> <span class="n">builder</span> <span class="p">=</span> <span class="n">WebApplication</span><span class="p">.</span><span class="nf">CreateBuilder</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>

<span class="n">builder</span><span class="p">.</span><span class="n">Host</span><span class="p">.</span><span class="nf">ConfigureAppConfiguration</span><span class="p">((</span><span class="n">context</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">keyVaultUrl</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Uri</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="n">Configuration</span><span class="p">.</span><span class="n">GetValue</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;(</span><span class="err">‚Äú</span><span class="n">KeyVaultUrl</span><span class="err">‚Äù</span><span class="p">));</span>
    <span class="n">config</span><span class="p">.</span><span class="nf">AddAzureKeyVault</span><span class="p">(</span><span class="n">keyVaultUrl</span><span class="p">,</span> <span class="k">new</span> <span class="nf">DefaultAzureCredential</span><span class="p">());</span> <span class="c1">// Esses tipos de credenciais ser√£o abordados a seguir!</span>
<span class="p">});</span></code></pre></figure>

<p>Agora, seu aplicativo sempre se conectar√° ao Key Vault, mesmo durante o desenvolvimento. O resultado √© que voc√™ n√£o precisa mais armazenar segredos em seu computador, pois eles s√£o sempre recuperados do Key Vault. Uma desvantagem dessa abordagem √© que voc√™ sempre precisa de uma conex√£o com a Internet para se conectar √† nuvem!</p>

<div class="callout callout-info">
  <div class="callout-title">
    <span class="callout-icon">‚ÑπÔ∏è</span>
    Info
  </div>
  <div class="callout-content">
    
<p>Devido aos benef√≠cios que essa solu√ß√£o traz, considere o uso dessa abordagem mesmo em cen√°rios em que o armazenamento de segredos localmente seria aceit√°vel. Um grande benef√≠cio dessa abordagem √© que voc√™ pode simplesmente clonar um projeto e, desde que tenha as permiss√µes corretas, pode execut√°-lo sem precisar configurar nenhum segredo em sua m√°quina, pois eles s√£o simplesmente recuperados da nuvem!</p>

  </div>
</div>

<h3 id="conectando-se-ao-azure-com-identidades-gerenciadas">Conectando-se ao Azure com identidades gerenciadas</h3>

<p>Nos exemplos de c√≥digo anteriores, voc√™ viu alguns tipos estranhos de credenciais: <code class="language-plaintext highlighter-rouge">ManagedIdentityCredential</code> e <code class="language-plaintext highlighter-rouge">DefaultAzureCredential</code>. Antes de discutirmos isso, considere o seguinte:</p>

<p>Queremos nos conectar a um provedor de armazenamento seguro de segredos para obter segredos com os quais executar nosso aplicativo. Para nos conectarmos a esse provedor, precisaremos passar algumas credenciais para que o provedor possa autorizar nossa solicita√ß√£o. <strong>Mas essas credenciais tamb√©m s√£o segredos, ent√£o onde as armazenamos</strong>? Poder√≠amos armazen√°-las em outro provedor de configura√ß√£o, mas isso n√£o anula todo o prop√≥sito de ter um provedor secreto? Se essas credenciais vazassem, algu√©m poderia acessar nossos segredos de qualquer forma! <strong>Para resumir, estamos lidando com um problema de galinha e ovo</strong>.</p>

<p>Felizmente, algumas pessoas inteligentes da Microsoft descobriram isso! Para o desenvolvimento local, voc√™ pode usar o <code class="language-plaintext highlighter-rouge">DefaultAzureCredential</code> para se comunicar com os servi√ßos do Azure. Esse tipo de credencial tentar√° se autenticar <a href="https://learn.microsoft.com/dotnet/api/overview/azure/identity-readme?WT.mc_id=DT-MVP-5005050#defaultazurecredential">usando v√°rios m√©todos</a>, como a conta da Microsoft com a qual voc√™ est√° conectado ao seu IDE, suas credenciais da CLI do Azure (<code class="language-plaintext highlighter-rouge">az</code>) e muito mais.</p>

<p><img src="/img/configuracao-dotnet/azure-identity.webp" alt="Uma vis√£o geral de como a Identidade do Azure funciona" /></p>

<p>A Identidade do Azure usa v√°rios m√©todos para autenticar a conta do Azure de um desenvolvedor.</p>

<p>Para ambientes de produ√ß√£o, a Microsoft recomenda <a href="https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/overview">Managed Identities</a> para <a href="https://learn.microsoft.com/dotnet/azure/sdk/authentication/?WT.mc_id=DT-MVP-5005050">autenticar com recursos do Azure</a>. As identidades gerenciadas s√£o um recurso do Microsoft Entra (anteriormente conhecido como Azure Active Directory) que permite criar uma identidade para seu aplicativo no Microsoft Entra. Essa identidade pode ser usada para autentica√ß√£o em outros servi√ßos do Azure, como o Key Vault. A vantagem dessa abordagem √© que voc√™ n√£o precisa mais armazenar nenhuma credencial no aplicativo, pois a identidade √© gerenciada pelo Azure AD.</p>

<p><img src="/img/configuracao-dotnet/azure-managed-identities.webp" alt="Um diagrama de como as Identidades Gerenciadas funcionam.&lt;/br&gt;" /></p>

<div class="callout callout-info">
  <div class="callout-title">
    <span class="callout-icon">‚ÑπÔ∏è</span>
    Info
  </div>
  <div class="callout-content">
    
<p>As Managed Identities podem ser bastante dif√≠ceis de entender em um primeiro momento. D√™ uma olhada na parte inferior do post para ver alguns links com mais informa√ß√µes sobre Managed Identities.</p>

  </div>
</div>

<h3 id="armazenamento-da-configura√ß√£o-na-configura√ß√£o-de-aplicativo-do-azure">Armazenamento da configura√ß√£o na Configura√ß√£o de Aplicativo do Azure</h3>

<p>Por √∫ltimo, mas n√£o menos importante, quero falar sobre a oferta de nuvem do Azure para gerenciamento de <em>configura√ß√£o</em>. Enquanto o Azure Key Vault abrange o gerenciamento de segredos, o <a href="https://azure.microsoft.com/products/app-configuration/?WT.mc_id=DT-MVP-5005050">Azure App configuration</a> √© uma oferta de SaaS que o ajudar√° a gerenciar sua configura√ß√£o. Esses dois servi√ßos funcionam muito bem juntos quando voc√™ vincula o Azure App Configuration ao Azure Key Vault. Se optar por usar esse servi√ßo, voc√™ s√≥ precisar√° adicionar o <a href="https://learn.microsoft.com/azure/azure-app-configuration/quickstart-aspnet-core-app?WT.mc_id=DT-MVP-5005050">Azure App Configuration como um provedor de configura√ß√£o</a> e, em seguida, poder√° usar o sistema de configura√ß√£o do .NET para acessar todas as suas configura√ß√µes E segredos da nuvem!</p>

<p>Ele tamb√©m tem muitos outros recursos, portanto, vale a pena dar uma olhada!</p>

<div class="callout callout-info">
  <div class="callout-title">
    <span class="callout-icon">‚ÑπÔ∏è</span>
    Info
  </div>
  <div class="callout-content">
    
<p>Considere a possibilidade de usar <a href="https://learn.microsoft.com/pt-br/azure/azure-app-configuration/howto-integrate-azure-managed-service-identity?WT.mc_id=DT-MVP-5005050&amp;pivots=framework-dotnet">identidades gerenciadas para acessar a Configura√ß√£o de Aplicativos</a> para aumentar a seguran√ßa!</p>


  </div>
</div>

<h2 id="finalizando">Finalizando</h2>

<p>Voc√™ chegou at√© o fim! Este post levou muito tempo para ser escrito, e estou feliz por finalmente ter sido conclu√≠do! Abaixo, voc√™ encontrar√° mais informa√ß√µes se quiser saber mais sobre os conceitos que abordei neste post. Se voc√™ tiver alguma d√∫vida, fique √† vontade para deixar um coment√°rio abaixo. Se quiser saber quando e onde darei a vers√£o de palestra deste post, confira minha p√°gina <a href="https://stenbrinke.nl/speaking">Speaking</a>.</p>

<h3 id="links-para-a-demo">Links para a demo</h3>

<p>Mencionei que o post √© um complemento de uma de minhas sess√µes. Essa sess√£o cont√©m v√°rias demonstra√ß√µes que mostram os conceitos discutidos nEste post. Voc√™ pode encontrar as demonstra√ß√µes <a href="https://github.com/sander1095/secure-secret-storage-with-asp-net-core/">aqui</a>.</p>

<h3 id="links-para-a-documenta√ß√£o-oficial">Links para a documenta√ß√£o oficial</h3>

<ul>
  <li><a href="https://learn.microsoft.com/dotnet/core/extensions/configuration?WT.mc_id=DT-MVP-5005050">Configura√ß√£o</a></li>
  <li><a href="https://learn.microsoft.com/aspnet/core/fundamentals/configuration?WT.mc_id=DT-MVP-5005050">Configura√ß√£o (especifica√ß√µes do ASP.NET Core)</a></li>
  <li><a href="https://learn.microsoft.com/aspnet/core/fundamentals/configuration/options?WT.mc_id=DT-MVP-5005050">options pattern</a></li>
  <li><a href="https://docs.microsoft.com/aspnet/core/security/app-secrets">user secrets</a></li>
  <li><a href="https://azure.microsoft.com/en-us/products/key-vault/?WT.mc_id=DT-MVP-5005050">Azure KeyVault</a></li>
  <li><a href="https://devblogs.microsoft.com/devops/demystifying-service-principals-managed-identities/?WT.mc_id=DT-MVP-5005050">Mais informa√ß√µes sobre Managed Identities</a></li>
</ul>

<hr />

<p>Voc√™ gostou deste post? <a href="https://ko-fi.com/stenbrinke"><img src="https://stenbrinke.nl/images/kofi_button_blue.webp" alt="Fa√ßa uma do√ß√£o para o autor original em https://ko-fi.com/stenbrinke.nl" /></a></p>

<h2 id="carlos-de-volta">Carlos de volta</h2>

<p>Carlos Schults de volta aqui. Espero que tenham gostado bastante do post, e sugiro que o coloquem nos favoritos para ser um recurso √∫til de consulta toda vez que surgir alguma d√∫vida referente ao gerenciamento de secrets e configura√ß√£o.</p>

<p>Agrade√ßo a Sander ten Brinke, autor do artigo original, que gentilmente me autorizou a traduz√≠-lo. O <a href="https://stenbrinke.nl/">blog dele</a> √© fant√°stico, tem muitos artigos extremamente bem escritos sobre diversos t√≥picos relacionados a .NET. Para quem sabe ingl√™s, recomendo fortemente a visita.</p>

<p>Gostaria de agradecer tamb√©m a <a href="https://andrewlock.net/about/">Andrew Lock</a>, o autor do livro <a href="https://www.manning.com/books/asp-net-core-in-action-third-edition">ASP.NET Core in Action</a>, por ter concedido autoriza√ß√£o para reproduzir uma imagem de seu livro.</p>

<p>A voc√™ que leu o artigo - todo ou apenas uma parte ‚Äî deixo tamb√©m um agradecimento e um pedido: me d√™ seu feedback. √â extremamente importante saber se as pessoas gostam desse tipo de conte√∫do, pois me motiva a continuar produzindo.</p>

<p>At√© a pr√≥xima!</p>

    
    
      
    
    
        Encontrou algum erro no post? <a href="http://github.com/carlosschults/carlosschults.github.io/edit/master/_posts/2024-07-23-configuracao-dotnet.md">Sugira uma edi√ß√£o</a>      
    
    
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
                    
            <a rel="previous" class="previous" href="/pt/csharp-expressoes-regulares">&larr; C# Regex: Como Express√µes Regulares Funcionam em C#, Com Exemplos </a>
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
        	    
            <a rel="next" class="next" href="/pt/git-detached-head">Erro 'Git Detached Head': O Que Significa e Como Resolver &rarr;</a>
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
      
    <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
        // Store these for reloads
        window.disqus_identifier = window.location.pathname;
        window.disqus_url = window.location.href;
        
        // Set initial theme - match it with the site's theme
        const currentTheme = document.body.getAttribute('data-theme') || 'light';
        this.page.theme = currentTheme === 'dark' ? 'dark' : 'light';
    };
    
    (function() {
        var d = document, s = d.createElement('script');
        s.src = '//carlosschultsblog.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>    
  </div>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">
    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">         
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/carlosschults"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">carlosschults</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/carlosschults"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">carlosschults</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Artigos sobre desenvolvimento de software e tecnologia.</p>
      </div>
    </div>

  </div>

</footer>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-92788641-1', 'auto');
  ga('send', 'pageview');

</script>

    <script src="/js/dark-mode.js"></script>
  </body>

</html>
