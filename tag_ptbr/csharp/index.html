<!DOCTYPE html>
<html lang="pt-BR">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Tag: csharp</title>
  <meta name="description" content="Veja os posts marcados com 'csharp'">
  
  <!-- Twitter card -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:creator" content="@carlosschults">
  <meta name="twitter:site" content="@carlosschults">
  <meta name="twitter:domain" content="carlosschults.net">
  <meta name="twitter:title" content="Tag: csharp">
  <meta name="twitter:description" content="Veja os posts marcados com 'csharp'">

   <!-- Facebook meta -->
  
  
  <meta property="og:title" content="Tag: csharp">
  <meta property="og:site_name" content="Carlos Schults / Blog" />
  <meta property="og:locale" content="pt_BR">  
  <meta property="og:type" content="website" />
  
  <meta property="og:url" content="http://carlosschults.net/tag_ptbr/csharp/"/>
  <meta property="og:description" content="Veja os posts marcados com 'csharp'">
  <link rel="stylesheet" href="/css/main.css">  
  
   <link rel="canonical" href="http://carlosschults.net/tag_ptbr/csharp/">
   
  
  
  <link rel="alternate" hreflang="en" href="/tag/csharp/" />
  <link rel="alternate" hreflang="pt" href="/tag_ptbr/csharp/" />
  <link rel="alternate" type="application/rss+xml" title="carlos schults / blog" href="http://carlosschults.net/rss.xml">
</head>

  <body>

    <header class="site-header">
  <div class="wrapper">    
    <a class="site-title" href="/pt/">carlos schults / blog</a>
    
    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">        
          
          <a class="page-link" href="/sobre/">Sobre</a>
		  <a class="page-link" href="/servicos/">Serviços</a>
          <a class="page-link" href="/busca/">Busca</a>
                  
      </div>
    </nav>

  </div>

</header>

<div class="wrapper" style="text-align: right; line-height: 2em">
  
  

  
   <a href="/tag/csharp/" class="en">en</a>  <a href="/tag_ptbr/csharp/" class="pt">pt</a> 
</div>


    <div class="page-content">
      <div class="wrapper">
        <h2 class="post_title">Tag: csharp</h2>
  
  
  
  
  
  
  
  
  
  
  
    <span class="post-meta"><time datetime='02-07-2020'>02/07/2020</time></span> 
    <h2>
          <a class="post-link" href="/pt/null-problematico">Null É Ruim. Qual A Melhor Alternativa? Null.</a>
    </h2>
    <div class="post-content">
    <p><img src="https://res.cloudinary.com/dz5ppacuo/image/upload/v1593715153/null-evill-1068x437_ztikwf.jpg" alt="" />
<span>Foto por <a href="https://unsplash.com/@benhershey?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Ben Hershey</a> on <a href="https://unsplash.com/s/photos/null?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></span></p>

<p><em>Nota editorial: Eu escrevi originalmente este post para o blog da NDepend. Você pode <a href="https://blog.ndepend.com/null-evil/">conferir o original aqui, em inglês, no site deles</a>.</em></p>

<p>“Null é maligno”. Se você tem sido um desenvolvedor de software por qualquer período de tempo razoável, aposto que já se deparou com essa afirmação várias vezes.</p>

<p>Eu diria também que é muito provável que você concorde com o sentimento, ou seja, que a referência nula é uma característica sem a qual nossas linguagens de programação ficariam melhor. Até mesmo seu criador expressou seu pesar pela referência nula, <a href="https://en.wikipedia.org/wiki/Tony_Hoare#Apologies_and_retractions">chamando-a de seu “erro de um bilhão de dólares”</a></p>

<p>Criticar null tende a ficar chato rapidamente, portanto, os autores não fazem só isso. Eles também oferecem alternativas. E embora eu acredite que muitas das alternativas apresentadas têm seus méritos, também acho que talvez tenhamos negligenciado a melhor solução para tudo isso.</p>

<p>Neste post, vamos examinar algumas das alternativas comuns para o retorno nulo antes de fazer o argumento de que a melhor alternativa é a própria nulidade. Vamos começar!</p>

<h2 id="null-é-tóxico">Null é Tóxico…</h2>

<p>Não vou me deter muito em toda essa coisa do “nulo é mal”, já que muito já foi escrito sobre isso. Alguns exemplos (em inglês):</p>

<p><a href="&quot;https://sidburn.github.io/blog/2016/03/20/null-is-evil&quot;&gt;Null is Evil">Null Is Evil</a>
<a href="&quot;http://blog.ploeh.dk/2015/11/13/null-has-no-type-but-maybe-has/&quot;&gt;">Null has no type, but Maybe has</a></p>

<p><a href="https://softwareengineering.stackexchange.com/questions/12777/are-null-references-really-a-bad-thing">Esta resposta de Stack Overflow</a> também tem algumas informações valiosas.</p>

<h2 id="mas-útil-quais-são-as-alternativas">…Mas útil. Quais são as Alternativas?</h2>

<p>Agora, espero que estejamos na mesma página no que diz respeito ao status de nulo como um recurso de linguagem problemática. Mas tóxico ou não, o nulo serve a alguns propósitos. As pessoas o usam para representar um dado ausente, inválido ou desconhecido, ou mesmo para indicar que ocorreu um erro.</p>

<p>O que deveriam estar fazendo ao invés disso?</p>

<h3 id="lançar-uma-exceção">Lançar uma Exceção</h3>

<p>Em algumas situações em que as pessoas retornam null, a coisa razoável a fazer é lançar uma exceção. Pense desta maneira: se um método promete realizar algo e não o faz, ele deve lançar uma exceção. Em outras palavras: quando um método não cumpre seu contrato, então é razoável disparar uma exceção.</p>

<p>É claro que você deve reservar exceções para cenários que sejam verdadeiramente excepcionais. Se uma determinada situação acontece com freqüência, então uma exceção não é a melhor solução.</p>

<h3 id="padrão-de-objeto-null">Padrão de Objeto Null</h3>

<p>Considere as seguintes linhas de código:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="kt">var</span> <span class="n">contract</span> <span class="p">=</span> <span class="n">repository</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="m">42</span><span class="p">);</span>
<span class="n">contract</span><span class="p">.</span><span class="nf">Extend</span><span class="p">(</span><span class="m">12</span><span class="p">);</span></code></pre></figure>

<p>O que deveria acontecer se não houvesse um contrato com ID igual a 42? Se o método “Find” retornar null, então você vai ganhar uma desagradável <code class="highlighter-rouge">NullReferenceException</code>. Como eu disse anteriormente, a nulidade faz seu código mentir. Se fossemos realmente pedantes sobre isso, o método “Find” deveria ser renomeado para “FindOrReturnNull”. Muito verboso, mas mais honesto.</p>

<p>De qualquer forma, o <a href="https://en.wikipedia.org/wiki/Null_object_pattern">padrão de objeto nulo</a> é uma tentativa de resolver este problema. E como ele faz isso? Criando seu próprio tipo de nulo.</p>

<p>Para implementar o padrão, criamos uma nova classe (vamos chamá-la de “NullContract”) que representa o caso quando um contrato está faltando. Fazemos esta nova classe cumprir o mesmo contrato que a classe original, mas não fazemos nada nos métodos. Assim, se imaginarmos que “Contrato” implementa <code class="highlighter-rouge">IContract</code>, nossa classe NullContract poderia ser algo parecido com isto:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">NullContract</span> <span class="p">:</span> <span class="n">IContract</span>
<span class="p">{</span>
	<span class="c1">// construtor, propriedades, etc </span>
	
	<span class="k">public</span> <span class="k">void</span> <span class="nf">Extend</span><span class="p">(</span><span class="kt">int</span> <span class="n">months</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="c1">// não faz nada aqui, propositalmente</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Ao empregar o padrão de objeto nulo você poderia - teoricamente, pelo menos - ter a certeza de que sempre receberá um objeto que cumpre o contrato que você espera que ele honre sem explodir na sua cara.</p>

<h3 id="maybeoption">Maybe/Option</h3>

<p>Finalmente, temos uma alternativa muito interessante que muitas vezes é encontrada na <a href="https://blog.ndepend.com/functional-programming-makes-code-not-oo/">programação funcional</a> linguagens. Esta alternativa é o uso de um tipo dedicado, destinado a representar o caso de uso de um valor potencialmente ausente. Por exemplo, <a href="https://docs.microsoft.com/en-us/dotnet/fsharp/language-reference/options">em F# isto é chamado de tipo de option</a>; Haskell a chama de <a href="https://hackage.haskell.org/package/base-4.11.0.0/docs/Data-Maybe.html">Maybe</a>. A partir da versão 8, Java introduziu a classe <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html">Optional</a>.</p>

<p>Neste momento, o C# não oferece algo parecido com este tipo nativamente.</p>

<h2 id="alternativas-ao-null-elas-são-boas">Alternativas ao Null: Elas são boas?</h2>

<p>Tendo apresentado as alternativas mais comumente usadas para nulo, é hora do veredicto final. Vamos começar com a opção “lançar exceção”.</p>

<h3 id="exceções">Exceções</h3>

<p>Se o chamador não fornecer os argumentos corretos para a função que está chamando, então poderíamos dizer que ele está quebrando o contrato da função. Lançar uma exceção é a coisa correta a fazer nesta situação.</p>

<p>O código a seguir é um bom exemplo do que <strong>não</strong>* deve ser feito:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="n">Foo</span> <span class="nf">Bar</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">string</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="p">&gt;</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">a</span> <span class="p">&lt;=</span> <span class="m">100</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrWhiteSpace</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="c1">// tá tudo certo: vamos fazer o que precisa ser feito e retornar</span>
            <span class="c1">// um novo objeto!</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">Foo</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
 
    <span class="c1">// Tem coisa errada com os parâmetros recebidos. Já sei! Vamos retornar null!</span>
    <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>Eu vejo códigos como este o tempo todo em produção. Os ifs aninhados são horríveis. Eles deveriam pelo menos ter usado um “and” para encaixar tudo em apenas um “if”. Mas o que realmente deveria acontecer é algo assim:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="n">Foo</span> <span class="nf">Bar</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">string</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="p">&lt;=</span> <span class="m">0</span> <span class="p">||</span> <span class="n">a</span> <span class="p">&gt;</span> <span class="m">100</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentOutOfRangeException</span><span class="p">(</span>
        <span class="k">nameof</span><span class="p">(</span><span class="n">a</span><span class="p">),</span>
        <span class="s">"O valor deve estar no intervalo de 1 a 100, inclusive."</span><span class="p">);</span>
    <span class="p">}</span>
 
    <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrWhiteSpace</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">(</span>
             <span class="s">"O valor deve ser uma string válida."</span><span class="p">,</span>
             <span class="k">nameof</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
             <span class="p">);</span>
    <span class="p">}</span>
 
    <span class="c1">// tá tudo certo: vamos fazer o que precisa ser feito e retornar</span>
    <span class="c1">// um novo objeto!</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">Foo</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

<p>Além disso, <a href="https://blogs.msdn.microsoft.com/ericlippert/2008/09/10/vexing-exceptions/">não capture exceções exógenas</a> que possam acontecer dentro de seu método e retorne nulo; em vez disso, deixe-as subir, pois este tipo de exceções representam problemas fora de seu controle. Problemas como uma falha na rede são problemas que você não poderia ter evitado de qualquer forma, em código.</p>

<h3 id="padrão-null-object">Padrão Null Object</h3>

<p>Vamos considerar o padrão de objeto nulo, do qual certamente não sou um grande fã. Um problema com este padrão é que você só deve usá-lo quando o código de chamada não se importa com o resultado do que quer que ele esteja tentando realizar. Considere novamente nosso exemplo de contrato:</p>

<figure class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="kt">var</span> <span class="n">contract</span> <span class="p">=</span> <span class="n">repository</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="m">42</span><span class="p">);</span><span class="n">contract</span><span class="p">.</span><span class="nf">Extend</span><span class="p">(</span><span class="m">12</span><span class="p">);</span></code></pre></figure>

<p>Esta linha de código não é “consciente” (nem se importa) se a variável “Contrato” se refere a um contrato válido ou a uma instância da NullContract. Se for um contrato válido, ele será prorrogado por 12 meses. Se não for, então nada acontecerá. Às vezes, é exatamente isso que você quer, mas nem sempre. Neste exemplo, se um contrato com ID equivale a 42 realmente deveria existir, mas não… talvez lançar uma exceção funcionaria melhor.</p>

<p>Tudo o que eu disse até agora é que o padrão de objeto nulo não é bem adequado para cada cenário. Isto não é um problema tão ruim assim; você poderia dizer o mesmo sobre praticamente qualquer coisa.</p>

<p>Meu principal problema com o padrão de objeto nulo é que ele equivale a pouco mais do que criar um novo tipo de objeto nulo sem realmente resolver o problema. Veja, <strong>utilizar o padrão não impede que você retorne nulo</strong>. Se eu consumir algum método escrito por um terceiro que afirma usar o padrão, devo ser capaz de assumir que o que quer que seja que ele retorne é seguro. Mas eu não posso ter certeza. Eu tenho três opções:</p>

<ul>
  <li>Confiar no autor do código;</li>
  <li>Inspecionar o código-fonte, se possível; ou</li>
  <li>Continuar a verificar a nulidade, o que derrota completamente o propósito de usar o padrão.</li>
</ul>

<p>Pode-se argumentar que estes problemas não são relevantes no contexto de uma única equipe que trabalha com a mesma base de código. Os desenvolvedores poderiam concordar em usar o padrão corretamente. Mas se tudo equivale a confiança e convenção no final do dia, você poderia muito bem concordar em nunca retornar nulo e teria o mesmo resultado.</p>

<h4 id="maybeoption-1">Maybe/Option</h4>

<p>Por último, mas não menos importante, e quanto aos tipos Maybe/Option? Esta é uma alternativa ao mesmo tempo elegante e robusta, especialmente em linguagens como o F#, onde você é forçado, de certa forma, a lidar com ambos os casos usando <em>pattern matching.</em></p>

<p>Mas a triste realidade é a seguinte: embora <code class="highlighter-rouge">Maybe/Option</code> sejam abordagens surpreendentes, elas não podem mudar o fato de que o nulo existe e continuará a existir. Você não pode realmente impedir as pessoas de usá-lo, nem pode removê-lo de todas as linhas de código que as pessoas têm escrito desde o início da história do C#.</p>

<p>Portanto, mesmo sendo grandes abordagens, elas ainda sofrem com o problema de serem mais um tipo de nulo para os desenvolvedores lidarem.</p>

<h2 id="a-solução-para-null-o-próprio-null">A solução para Null: O próprio Null</h2>

<p>Você conhece o velho ditado “Quando em um buraco, pare de cavar”? Para o melhor ou para o pior, existe o nulo. Tóxico ou não, é uma característica que as pessoas usam. Portanto, talvez a solução para tudo isso seja apenas consertar o nulo.</p>

<p>A linguagem <a href="https://kotlinlang.org/">kotlin</a> acertou ao ter diferentes tipos de nulos e não nulos e adicionar todos os tipos de verificações para evitar que o desenvolvedor faça coisas que acabariam mal, como desreferenciar um tipo nulo sem verificá-lo ou atribuir um valor nulo a uma variável não nula.</p>

<p>O C# nos deu o primeiro passo na direção certa há muitos anos com <a href="https://docs.microsoft.com/pt-br/dotnet/csharp/programming-guide/nullable-types/">tipos de valor nulo</a>. Após uma longa espera, <a href="https://blog.ndepend.com/c-8-0-features-glimpse-future/">tipos de referência finalmente obterão o mesmo benefício com C# 8.0</a>.</p>

<p>A alternativa para o nulo é o próprio nulo… <strong>quando feito corretamente</strong>.</p>

    <a href="/pt/null-problematico">leia mais...</a>
   </div>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <span class="post-meta"><time datetime='22-01-2019'>22/01/2019</time></span> 
    <h2>
          <a class="post-link" href="/pt/programacao-funcional-csharp/">Programação Funcional em C#: Mapeando, Filtrando e Reduzindo Em Busca de Código Limpo</a>
    </h2>
    <div class="post-content">
    <p><img src="https://res.cloudinary.com/dz5ppacuo/image/upload/v1548200356/Untitled_xfahmy.jpg" alt="" /></p>

<p><em>NOTA: Este post foi originalmente publicado no blog da SubMain. Você pode <a href="https://blog.submain.com/csharp-functional-programming/">ler o original aqui, em inglês</a>. Aproveite para conferir o CodeIt.Right, um produto que pode ajudar a melhorar seu código.</em></p>

<p>Você provavelmente pensa no C# como uma linguagem orientada a objeto. Mas é possível que você, ao programar em C#, tenha usado conceitos de programação funcional sem sequer ter notado.</p>

<p>O post de hoje trata desse tema. Vou começar abordando as vantagens da programação funcional, mostrando a justificativa se aplicá-la mesmo usando uma assim chamada linguagem orientada a objetos. Depois vou explicar como você já está usando um pouco do estilo funcional em seu código C#, mesmo sem estar ciente disso. Finalmente, vou demonstrar como aplicar um pouco de pensamento funcional ao seu código pode torná-lo mais limpo, seguro e mais expressivo.</p>

<h2 id="programação-funcional-em-c-por-quê">Programação Funcional em C#: Por quê?</h2>

<p>Nós sabemos que o .NET framework oferece algumas capacidades funcionais na forma dos métodos de extensão do LINQ, mas qual seria a vantagem de usá-las?</p>

<p>Para responder bem essa pergunta, precisamos voltar um passo e entender os atrativos da programação funcional em si. Na minha opinião, para começar a entender os benefícios da programação funcional você precisa primeiro entender dois tópicos: <strong>funções puras</strong> e <strong>imutabilidade</strong>.</p>

<p><strong>Funções puras</strong> são funções que apenas podem acessar os valores que receberam por argumentos e, como consequência, não podem ter nenhum efeito colateral. <strong>Imutabilidade</strong> se refere a objetos ou estruturas de dados que, uma vez inicializados, não podem sofrer nenhuma mudança em seus valores. Isso os torna mais fáceis de entender e seguros para serem usados em código com múltiplas threads.</p>

<h2 id="operações-fundamentais-da-programação-funcional-e-como-executá-las-usando-c">Operações Fundamentais da Programação Funcional e Como Executá-las Usando C#</h2>

<p>Como já cobrimos o <em>o quê</em> e o <em>porquê</em> da programação funcional, está na hora de vermos o <em>como</em>.</p>

<p>Eu vou abordar três operações: <strong>map</strong>, <strong>filter</strong> e <strong>reduce</strong>. Vou começar mostrando alguns problemas, usando uma abordagem procedural tradicional para resolvê-los. Em seguida, vou apresentar a alternativa usando o estilo funcional.</p>

<h2 id="map">Map</h2>

<p>Em termos simples, a operação “map” recebe uma sequência de valores, aplica alguma transformação em cada um dos itens, e retorna uma nova sequência contendo os valores resultantes. Vamos ver alguns exemplos:</p>

<p>Imagine que você escreveu o código a seguir, devido à requisição de algum cliente:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#">	<span class="k">static</span> <span class="k">void</span> <span class="nf">AddThreeToEachElement</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span> <span class="n">arr</span><span class="p">)</span>
	<span class="p">{</span>
	    <span class="k">for</span> <span class="p">(</span><span class="kt">var</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">arr</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
	    <span class="p">{</span>
	       <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">+=</span> <span class="m">3</span><span class="p">;</span>
	    <span class="p">}</span>
	<span class="p">}</span></code></pre></figure>

<p>É uma função que adiciona três a cada elemento do <a href="https://blog.submain.com/c-array/">array</a> de inteiros especificado. Bem tranquilo.</p>

<p>Então aparece o pedido de uma nova função. Dessa vez, é para adicionar cinco a cada elemento do vetor. Ignorando a <a href="https://en.wikipedia.org/wiki/Rule_of_three_(computer_programming)">regra de três,</a> você pula direto para uma versão generalizada, parametrizando o número a ser adicionado:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#">	<span class="k">static</span> <span class="k">void</span> <span class="nf">AddNumberToEachElement</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span> <span class="n">arr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
	<span class="p">{</span>
	   <span class="k">for</span> <span class="p">(</span><span class="kt">var</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">arr</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
	   <span class="p">{</span>
	        <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">+=</span> <span class="n">n</span><span class="p">;</span>
	   <span class="p">}</span>
	<span class="p">}</span></code></pre></figure>

<p>Então aparece um novo pedido. Agora você tem que escrever uma função para multiplicar cada elemento do array especificado por três. Não vou me dar ao trabalho de adicionar o código de exemplo, porque seria bem trivial. A esse ponto, você já sabe o suficiente para evitar fixar o número no código, então você provavelmente vai pular direto para uma versão generalizada. Mesmo assim, alguma duplicação ainda vai permanecer: o laço de repetição em si. E se você pudesse manter o loop e parametrizar a ação a ser aplicada nos itens?</p>

<h3 id="a-maneira-funcional">A Maneira Funcional</h3>

<p>Leve em consideração o que você acabou de ler sobre funções puras—e também seu conhecimento prévio de <a href="https://blog.submain.com/coding-best-practices-short-time/">boas práticas de programação</a> em geral—e pense em maneiras nas quais o código do exemplo poderia ser melhorado.</p>

<p>No meu ponto de vista, os problemas principais são:</p>

<ul>
  <li><strong>O código é muito específico</strong>. Não é fácil modificá-lo para acomodar outras transformações a serem aplicadas nos elementos do array. O código só faz uma soma, e é só.</li>
  <li><strong>Muito código boilerplate</strong>. Olhe novamente o exemplo anterior. Conte as linhas. Há sete, das quais apenas uma realmente tem algo a ver com a regra de negócio do método.</li>
</ul>

<p>Como que o estilo funcional pode melhorar isso? O código a seguir mostra como eu reescreveria o exemplo em F#, por exemplo:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#">	<span class="k">let</span> <span class="n">result</span> <span class="p">=</span> <span class="n">Seq</span><span class="p">.</span><span class="nf">map</span> <span class="p">(</span><span class="n">fun</span> <span class="n">x</span> <span class="p">-&gt;</span> <span class="n">x</span> <span class="p">+</span> <span class="m">3</span><span class="p">)</span> <span class="n">numbers</span></code></pre></figure>

<p>Aqui, “numbers” represente uma sequência de números que eu consegui de alguma forma. Então eu uso a função <strong>map</strong> que pertence ao módulo <strong>Seq</strong>, passando a sequência como um dos parâmetros, junto com uma função que recebe um número inteiro e adiciona três a ele.</p>

<h3 id="o-jeito-funcional-sabor-c">O Jeito Funcional, sabor C#</h3>

<p>O .NET implementa a operação map na forma do método de extensão do LINQ chamado “Select.” Então, para converter o código em F# acima para C#, você faria assim:</p>

<p>var result = numbers.Select(x =&gt; x + 3);</p>

<p>É importante salientar o que o tipo da sequência resultante não precisa ser o mesmo da sequência de entrada. Você tem uma lista de objetos do tipo “Employee” e precisa recuperar os seus ids, na forma de uma sequência de ints? Fácil:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#">	<span class="n">List</span><span class="p">&lt;</span><span class="n">Employee</span><span class="p">&gt;</span> <span class="n">employees</span> <span class="p">=</span> <span class="n">EmployeeRepository</span><span class="p">.</span><span class="nf">All</span><span class="p">();</span>
	<span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">ids</span> <span class="p">=</span> <span class="n">employees</span><span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span></code></pre></figure>

<h2 id="filter">Filter</h2>

<p>A operação filter é, sem dúvida, a mais fácil das três. Ela tem um nome bastante intuitivo, e a necessidade de se filtrar coisas é algo tão comum na programação que eu tenho certeza de que você adivinhou o que ela faz só pelo nome (caso já não soubesse antes).</p>

<p>Mesmo assim, vamos defini-la. A operação filter filtra uma sequência, retornando uma nova sequência contendo apenas os itens aprovados por um ou mais critérios especificados.</p>

<h3 id="o-jeito-imperativo">O Jeito Imperativo</h3>

<p>Já que nós usamos o exemplo de “employees” na seção anterior, vamos continuar dentro do mesmo tema. Digamos que você precise recuperar uma lista com os funcionários que tenham tirado pelo menos três dias de atestado médico.</p>

<p>Em um estilo mais procedura, você provavelmente escreveria algo assim:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#">	<span class="k">public</span> <span class="k">static</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Employee</span><span class="p">&gt;</span> <span class="nf">GetEmployeesWithAtLeastNSickdays</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">Employee</span><span class="p">&gt;</span> <span class="n">employees</span><span class="p">,</span> <span class="kt">int</span> <span class="n">number</span><span class="p">)</span>
	<span class="p">{</span>
	    <span class="n">List</span><span class="p">&lt;</span><span class="n">Employee</span><span class="p">&gt;</span> <span class="n">result</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Employee</span><span class="p">&gt;();</span>
	
	    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">e</span> <span class="k">in</span> <span class="n">employees</span><span class="p">)</span>
	    <span class="p">{</span>
	        <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Sickdays</span> <span class="p">&gt;=</span> <span class="n">number</span><span class="p">)</span>
	        <span class="p">{</span>
	            <span class="n">result</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
	        <span class="p">}</span>   
	    <span class="p">}</span>
	
	    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
	<span class="p">}</span></code></pre></figure>

<p>Eu não acho que o código acima esteja errado. O nome do método é um pouco longo, porém bastante descritivo. O código faz o que promete. E a legibilidade está boa.</p>

<p>Mas da mesma forma que no exemplo anterior, nós poderíamos fazer o argumento de que o código está poluído demais Podemos dizer quem, na prática, a única linha que faz algo relacionado à lógica do problema é o teste do if. Todas as outras linhas são código boilerplate. Será que a abordagem funcional consegue melhorar a situação?</p>

<h3 id="a-maneira-funcional-1">A Maneira Funcional</h3>

<p>Vamos reescrever o código acima usando LINQ:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#">	<span class="k">public</span> <span class="k">static</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Employee</span><span class="p">&gt;</span> <span class="nf">GetEmployeesWithAtLeastNSickdays</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;</span><span class="n">Employee</span><span class="p">&gt;</span> <span class="n">employees</span><span class="p">,</span> <span class="kt">int</span> <span class="n">number</span><span class="p">)</span>
	<span class="p">{</span>
	    <span class="k">return</span> <span class="n">employees</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">SickDays</span> <span class="p">&gt;=</span> <span class="n">n</span><span class="p">).</span><span class="nf">ToList</span><span class="p">();</span>
	<span class="p">}</span></code></pre></figure>

<p>Here we use the “Where” extension method, passing the filtering criterium as a delegate. To be honest, the outer method became not very useful since it just delegates the work. In real life, I’d get rid of it.</p>

<p>Aqui nós usamos o método “Here”, passando o critério de filtragem como parâmetro. Para ser honesto, o método de fora não é tão útil, já que ele só delega o trabalho para o método do LINQ. Na vida real, em código de produção, eu jogaria ele fora.</p>

<h2 id="reduce">Reduce</h2>

<p>Geralmente, a operação reduce é a que algumas pessoas costumam ter dificuldade entendendo. Mas não tem nada de difícil. Pense dessa forma: você tem uma sequência de alguma coisa, e também tem uma função que recebe duas dessas coisas e retorna uma.</p>

<p>Então você começa a aplicar a função. Você a aplica nos dois primeiros elementos na sequência e guarda o resultado. Então aplica de novo, com o resultado e o terceiro elemento. Depois faz a mesma coisa, aplicando a função ao resultado da última etapa e o quarto elemento, e assim sucessivamente.</p>

<p>O exemplo clássico do reduce é a soma de uma lista de números, então é exatamente isso que vamos fazer.</p>

<h3 id="o-modo-imperativo">O Modo Imperativo</h3>

<p>Suponha que temos que somar um punhado de números inteiros. Poderíamos fazer assim:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#">	<span class="k">public</span> <span class="kt">int</span> <span class="nf">Sum</span><span class="p">(</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">numbers</span><span class="p">)</span>
	<span class="p">{</span>
	    <span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
	    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">number</span> <span class="k">in</span> <span class="n">numbers</span><span class="p">)</span>
	    <span class="p">{</span>
	        <span class="n">result</span> <span class="p">+=</span> <span class="n">number</span><span class="p">;</span>
	    <span class="p">}</span>
	
	    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
	<span class="p">}</span></code></pre></figure>

<p>A essa altura do campeonato você já pode até prever o que eu tenho a dizer a respeito desse código: não está necessariamente errado, mas é pouco flexível e cheio de ruído. Mas a programação funcional pode nos salvar.</p>

<h3 id="o-modo-funcional">O Modo Funcional</h3>

<p>No .NET framework, a operação “reduce” toma a forma do método de extensão “Aggregate”. Dessa vez, vou me livrar do método externo e escrever a solução usando LINQ de uma vez:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#">	<span class="kt">var</span> <span class="n">sum</span> <span class="p">=</span> <span class="n">number</span><span class="p">.</span><span class="nf">Aggregate</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">x</span> <span class="p">+</span> <span class="n">y</span><span class="p">);</span></code></pre></figure>

<p>A aparência disso é um pouco mais complexa, mas não se assuste. Nesse caso, nós estamos apenas passando uma função que recebe dois parâmetros ao invés de um só, como nos exemplos anteriores. Precisa ser assim, já que a função precisa ser aplicada a dois elementos da sequência cada vez.</p>

<p>But as it turns out, there’s an even easier way of solving this particular problem (adding a bunch of numbers). Since summing a sequence of numbers is such a common use case, there’s a dedicated method to do just that. It’s called, not surprisingly, “Sum”:</p>

<p>Mas na verdade tem uma maneira ainda mais fácil de resolver esse problema em particular (somar vários números).
Sendo esse um caso de uso tão comum, o framework disponibiliza um método dedicado para fazer só isso. O qual, surpreendendo a um total de zero pessoas, é chamado de “Sum”:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#">	<span class="kt">var</span> <span class="n">sum</span> <span class="p">=</span> <span class="n">numbers</span><span class="p">.</span><span class="nf">Sum</span><span class="p">();</span></code></pre></figure>

<p>Para que serve o “Aggregate”, então? Adicionar uma lista de números é apenas uma das muitas aplicações do reduce, mas você pode usá-lo com qualquer operação binária, como concatenação de strings ou a soma de tipos customizados.</p>

<h2 id="o-veredito-a-abordagem-funcional-é-melhor">O Veredito: A Abordagem Funcional é Melhor?</h2>

<p>Após esses exemplos, você talvez esteja em dúvida se o jeito funcional de fazer as coisas é realmente melhor. Seria extremamente difícil definir o que “melhor” significa, então nem vou tentar. Vamos considerar outro critério: legibilidade.</p>

<p>Apesar de sabermos que legibilidade de código <a href="https://blog.submain.com/evaluate-code-readability/">também pode ser bastante subjetiva,</a> eu diria que sim, os exemplos funcionais são mais legíveis. Imagine que nós recuperar e somar todos os salários dos funcionários com mais de cinco anos de casa. Nós poderíamos facilmente fazer isso usando um loop, dentro do qual nós testaríamos a condição e acumularíamos o salário em uma variável, caso o teste tenha retornado verdadeiro.</p>

<p>Ou poderíamos escrever isso:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#">	<span class="kt">var</span> <span class="n">sum</span> <span class="p">=</span> <span class="n">employees</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">CompanyTimeInYears</span> <span class="p">&gt;</span> <span class="m">5</span><span class="p">).</span><span class="nf">Select</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Salary</span><span class="p">).</span><span class="nf">Sum</span><span class="p">();</span></code></pre></figure>

<p>Eu honestamente acredito que essa versão é mais legível (e melhor, em geral) que a abordagem procedural. É mais declarativa. Ela demonstra a intenção do <strong>que</strong> estamos tentando fazer sem se preocupar tanto com o <strong>como</strong>.</p>

<p>It almost reads like natural language: “The list of employees where their time in the company is greater than five years, select their salary and sum them”.</p>

<p>Para quem entende inglês, quase parece linguagem natural: “Da lista de todos os funcionários, onde o tempo de empresa é mais de cinco anos, selecione o salário e some.”</p>

<h2 id="uso-um-pouco-de-tempero-funcional-e-deixe-seu-código-mais-saboroso">Uso Um Pouco de Tempero Funcional e Deixe Seu Código Mais Saboroso</h2>

<p>Muitas pessoas usam LINQ por anos sem nem perceber que estão usando conceitos de programação funcional. Eu enxergo isso como prova de que a programação funcional não está além das capacidades do típico desenvolvedor enterprise que não tem uma sólida formação matemática.</p>

<p>Alguns dos conceitos apresentados aqui não são novos nem restritos à programação funcional. Os benefícios de distinguir entre funções que causam efeitos colaterais e as que não causam é a base de princípios como <a href="https://en.wikipedia.org/wiki/Command%E2%80%93query_separation">command-query separation (CQS)</a>, por exemplo.</p>

<p>O objetivo desse post não é ensinar programação funcional para ninguém. Isso está além das minhas capacidades, já que eu ainda estou aprendendo. E além disso, <a href="https://fsharpforfunandprofit.com">existem ótimos recursos para aprender programação funcional, para aqueles que se interessarem</a>.</p>

<p>Ao contrário, o que eu queria fazer aqui era mostrar um pouco do que um estilo funcional pode fazer com seu código: torná-lo mais expressivo, conciso e declarativo. Agora depende de você aplicar o estilo funcional ao código que você escreve.</p>

    <a href="/pt/programacao-funcional-csharp/">leia mais...</a>
   </div>
  
  
  
  
  
  
  
  
  
  
    <span class="post-meta"><time datetime='24-10-2018'>24/10/2018</time></span> 
    <h2>
          <a class="post-link" href="/pt/value-objects-ferramenta/">Value Objects: Uma Técnica Para Código Auto-Documentado E Menos Erros</a>
    </h2>
    <div class="post-content">
    <p><img src="https://res.cloudinary.com/dz5ppacuo/image/upload/v1540385528/value-object-tool/value-object-tool-1038x437.jpg" alt="" /></p>

<p><em>NOTA: Eu escrevi este post originalmente para o blog da NDepend. Você pode <a href="https://blog.ndepend.com/value-objects-tool-self-documented-code-fewer-errors/">conferir o artigo original, em inglês, no site deles</a>. Aproveite que está lá e faça o download do NDepend.</em></p>

<p>Você já ouviu falar de <em>value objects</em>? Eu imagino que sim. Apesar de não se falar tanto a respeito deles como eu gostaria, eles ainda são mencionados o bastante para que muitos desenvolvedores tenham no mínimo alguma familiaridade com o termo.</p>

<p>Porém, “alguma familiaridade” não é bom o bastante. Então é isso que vamos consertar com esse post. Hoje vamos aprender o que <em>value objects</em> são e como você, por meio do C#, pode usar todo o poder deles para tornar seu código mais claro, auto-documentável e menos propenso a erros.</p>

<h2 id="o-que-sãovalue-objects">O que são Value Objects?</h2>

<p><em>Value objects</em> são um dos blocos fundamentais do DDD (Domain Driven Design, ou Projeto Guiado por Domínio, em tradução livre), conforme proposto por Eric Evans em seu livro <a href="https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215">Domain-Driven Design: Tackling Complexity in the Heart of Software.</a></p>

<p>Da maneira mais simples possível, um value object é um objeto que representa um valor. E sim, eu estou ciente de que isso soa óbvio e tedioso quando dito dessa forma. Então, por que tanto barulho por causa desse conceito?</p>

<h2 id="algumas-propriedades">Algumas Propriedades</h2>

<p>Eu acho que é mais fácil de entender value objects se eu parar de tentar explicar o que eles são e, ao invés disso, falar sobre as suas características.</p>

<h3 id="value-objects-não-têm-identidade">Value Objects Não Têm Identidade</h3>

<p>Eu acho que é justo dizer que a principal característica dos value objects é que eles não possuem <em>identidade</em>. Mas o que isso realmente quer dizer na prática?</p>

<p>Digamos que você vá até o caixa eletrônico mais próximo e deposite uma nota de 50 reais em sua conta. Então você dirige umas duas horas até outra cidade, entra em uma agência bancária, e saca 50 reais.</p>

<p>Pergunta: faz alguma diferença para você o fato de que a nota que você tem em mãos não é a mesma que você depositou antes? É claro que não! Quando se trata de dinheiro o que as pessoas geralmente se importam é com seu valor, não com o veículo daquele valor.</p>

<p>Em outras palavras, nós não damos a mínima para a <em>identidade</em> daquela cédula em particular. A única coisa com a qual nós nos importamos é o seu valor.</p>

<p>Não é coincidência o fato de que dinheiro é um exemplo clássico de value object na literatura.</p>

<h3 id="value-objects-são-imutáveis">Value Objects São Imutáveis</h3>

<p>Você consegue mudar o número cinco? Não. Não há nada que você (ou qualquer outra pessoa) possa fazer para mudar o valor do número 5. Se você adicionar 1, ele não muda. Você tem agora 6, que é um <em>outro</em> número.</p>

<p>É possível alterar uma data? Não, também não dá para fazer isso. Se você inicia com “2018-01-09” e adiciona um dia, você chega em “2018-01-10.” O valor original não é alterado de forma alguma. Na verdade, a imutabilidade de um value object é uma consequência direta do ponto anterior; como um value object não possui identidade, podemos dizer que o value object <em>é</em> o seu valor. Portanto, nem sequer faz sentido falar sobre mudá-lo.</p>

<p>A implicação disso no desenvolvimento é que value objects são intrinsecamente mais seguros e mais fáceis de serem compreendidos. Não tem perigo de mudar por acidente aquilo que você não pode mudar de jeito nenhum.</p>

<h3 id="value-objects-têm-igualdade-estrutural">Value Objects Têm Igualdade Estrutural</h3>
<p>Imagine que você pudesse magicamente transportar pessoas para qualquer lugar que você quisesse e, por alguma razão bizarra, você tenha decidido trocar dois homens chamados “João da Silva” durante a noite. Como você acha que as suas respectivas famílias reagiriam ao encontrar um estranho em casa na manhã seguinte?</p>

<p>Obviamente, pessoas não são intercambiáveis, mesmo que compartilhem uma ou mais características. Mesmo se nossos dois “Joães” (Joões?) tivessem não apenas o mesmo nome, mas também a mesma altura, peso, cor de pele e cabelo, eles ainda seriam duas pessoas completamente diferentes. Mesmo gêmeos idênticos (ou clones, caso você esteja numa onda meio Black Mirror) continuam sendo pessoas completamente diferentes, apesar de serem tão iguais um ao outro quanto é possível ser.</p>

<p>Por outro lado, as pessoas mudam constantemente durante a vida, mas continuam sendo as mesmas pessoas. Pelo menos (enquanto a gente não resolver filosofar com “<a href="https://www.brainyquote.com/quotes/heraclitus_107157">um homem não entra no mesmo rio duas vezes</a>” e coisas do tipo).</p>

<p>Você talvez esteja se perguntando se eu divaguei demais aqui, mas é tudo de propósito. Tudo isso serve apenas para ilustrar a diferença crucial entre entidades e value objects. Com as entidades, nós nos importamos com a  sua identidade, não com o valor de seus atributos. Com value objects, é exatamente o oposto.</p>

<p>A implicação disso, em termos de programação, é que value objects tipicamente apresentam igualidade estrutural. Faz sentido compará-los pelos seus valores, não suas referências ou identidades. Então, quando for implementar um value object, sempre faça <em>override</em> dos métodos <code class="highlighter-rouge">Equals</code> e <code class="highlighter-rouge">GetHashCode</code>.</p>

<h2 id="o-que-você-ganha-com-isso">O que Você Ganha Com Isso?</h2>
<p>A essa altura você já deve ter uma boa ideia do que value objects são. O que ainda não está claro é: por que você deveria usá-los? Para responder isso, vamos dar uma olhada na linha de código a seguir:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#">    <span class="kt">double</span>  <span class="n">distance</span>  <span class="p">=</span>  <span class="m">4.5</span><span class="p">;</span></code></pre></figure>

<p>Tem algo errado com a linha acima? Bom, eu poderia dar uma de <em><a href="https://starwars.wikia.com/wiki/Wookieepedia:Quote_of_the_Day/Archive/Obi-Wan_Kenobi">Ben Kenobi</a> </em>e dizer que está errada “de um certo ponto de vista.” Mas eu não vou. Ao invés disso, vou dizer que está definitivamente, sem sombra de dúvidas, errada. Não importa que compila corretamente. Também não importa que funciona um pouco (ou até na maioria) do tempo.</p>

<p>O problema aqui é o <em>code smell</em> conhecido como “obsessão primitiva”, isto é, a modelagem de conceitos de domínio usando tipos primitivos. As próximas seções vão explicar melhor porque isso é um problema tão sério e como o uso de <em>value objects</em> podem ajudar.</p>

<h3 id="value-objects-proporcionam-contexto">Value Objects Proporcionam Contexto</h3>

<p>Por que <a href="https://blog.ndepend.com/easy-miss-code-smells/">obsessão primitiva é algo ruim</a>? Há várias razões, mas um dos principais problemas com a linha de código que você viu na seção anterior é que há uma informação extremamente importante faltando. Como você pode ver, o código atribui o valor 4.5 à variável. Mas 4.5 o que? Metros? Quilômetros? Milhas? Parsecs? Em outras palavras, falta uma <strong>unidade de medida</strong>.</p>

<p>Isso pode ser uma receita para o desastre. Tudo o que você precisa é alguém recuperar um valor do banco de dados ou de um arquivo, pensando que representa metros mas na verdade são quilômetros. Quando a pessoa resolve usar o valor em um cálculo, adicionando quilômetros com metros…silêncio. Você agora tem um programa que, no lugar de falhar rápido como deveria, se comporta de maneira errada silenciosamente enquanto corrompe dados e gera resultados inconsistentes. Ainda bem que você usa <a href="https://blog.ndepend.com/unit-testing-affect-codebases/">testes unitários</a>…certo?</p>

<p>Tudo bem, nada impede você de colocar essa informação no próprio nome da variável:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#">	<span class="kt">double</span>  <span class="n">distanceInKilometers</span>  <span class="p">=</span>  <span class="m">4.5</span><span class="p">;</span></code></pre></figure>

<p>Certo, isso é um pouco melhor do que a versão anterior, mas ainda é uma solução muito frágil. A qualquer momento o valor pode ser atribuído a outra variável ou passado como argumento para uma função, e aí a unidade de medida é perdida.</p>

<p>Usando value objects, você pode eliminar esse problema facilmente. Você teria apenas que escolher uma unidade para ser a representação interna do tipo - para distância, faz sentido usar o metro, por ser uma unidade do Sistema Internacional de Medidas. E aí você pode implementar diversos métodos estáticos para fabricar valores para cada unidade necessária:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#">	<span class="kt">var</span>  <span class="n">distance</span>  <span class="p">=</span>  <span class="n">Distance</span><span class="p">.</span><span class="nf">FromMeters</span><span class="p">(</span><span class="m">4000</span><span class="p">);</span>
	<span class="kt">var</span>  <span class="n">distance2</span>  <span class="p">=</span>  <span class="n">Distance</span><span class="p">.</span><span class="nf">FromKilometers</span><span class="p">(</span><span class="m">4</span><span class="p">);</span>
	<span class="n">Assert</span><span class="p">.</span><span class="nf">AreEqual</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span>  <span class="n">distance2</span><span class="p">);</span></code></pre></figure>

<p>Você poderia ainda sobrecarregar o operador “+” (ou criar um método <code class="highlighter-rouge">Plus</code>). Dessa forma seria possível somar duas distâncias que se originaram de diferentes unidades de medida já que a representação interna é a mesma.</p>

<h3 id="value-objects-apresentam-segurança-de-tipo">Value Objects Apresentam Segurança de Tipo</h3>

<p>Digamos que você tem um método com a seguinte assinatura:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#">	<span class="kt">double</span>  <span class="nf">PerformSomeImportantCalculation</span><span class="p">(</span><span class="kt">double</span>  <span class="n">distance</span><span class="p">,</span>  <span class="kt">double</span>  <span class="n">temperature</span><span class="p">);</span></code></pre></figure>

<p>O que aconteceria se você cometesse um erro e invertesse os valores ao chamar o método? O programa iria silenciosamente se comportar erro, e você nem ficaria sabendo. Com sorte, a sua empresa teria um bom processo de garantia de qualidade que poderia pegar esse erro antes de chegar no ambiente de produção. Mas ficar dependendo de sorte não é lá uma grande estratégia, concorda?</p>

<p>Pois acontece que esse é o tipo de problema que value objects são ótimos em evitar. Você teria apenas que usar topos customizados para cada conceito em vez de tipos primitivos:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#">	<span class="kt">double</span>  <span class="nf">PerformSomeImportantCalculation</span><span class="p">(</span><span class="n">Distance</span> <span class="n">distance</span><span class="p">,</span>  <span class="n">Temperature</span> <span class="n">temperature</span><span class="p">);</span></code></pre></figure>

<p>Dessa forma, se torna impossível passar os parâmetros na ordem errada: o compilador simplesmente não deixa!</p>

<h3 id="value-objects-evitam-duplicação-de-lógica-de-domínio">Value Objects Evitam Duplicação de Lógica de Domínio</h3>

<p>Quando você usa tipos primitivos para modelar conceitos de domínio, a tendência é você ter um monte de código relacionado a esses conceitos espalhados por toda a aplicação. Imagine que você está criando um programa que tem o conceito de uma placa de carro, e você está usando <code class="highlighter-rouge">strings</code> para representá-las. É claro que nem todas as strings válidas são placas válidas. Então o seu código acaba entupido de validações de placas de carro por todo lugar.</p>

<p>Isso seria evitado criando uma classe chamada <code class="highlighter-rouge">LicensePlate</code> e fazendo todas as validações necessárias em seu construtor. Dessa forma você consolidaria todo o código de validação em apenas um lugar; se esse código precisar mudar no futuro, você tem que mudar em apenas um lugar.</p>

<h2 id="value-objects-e-tipos-de-valor-não-são-sinônimos">Value Objects e Tipos de Valor Não São Sinônimos</h2>

<p>Essa seção é necessária para clarificar um erro comum, que é confundir  value objects com o conceito de value types (tipos de valor) que existe no C#. É assim: na linguagem C# nós temos <a href="https://carlosschults.net/pt/tipos-valor-referencia-em-csharp/">duas categorias de tipos: tipos de referência e tipos de valor.</a></p>

<p>Sim, não há nada que impeça você de usar structs (tipos de valor) para implementar value objects - exemplos na Base Class Library (BCL) seriam o tipo <code class="highlighter-rouge">DateTime</code> ou os tipos numéricos primitivos. Mas você também pode usar classes tranquilamente.</p>

<p>Por outro lado, structs não podem ser considerados value objects automaticamente. Por exemplo, embora manter structs imutáveis seja uma prática recomendada, eles não são imutáveis por padrão.</p>

<p>Resumidamente, “tipo de valor” é um detalhe de implementação em C#/.NET e “value object” é um padrão de projeto. Mantenha isso em mente e consulte <a href="https://docs.microsoft.com/pt-br/dotnet/standard/design-guidelines/choosing-between-class-and-struct">as diretrizes de design da Microsoft</a> e tudo vai ficar bem.</p>

<h2 id="value-objects-valem-a-pena">Value Objects Valem a Pena!</h2>

<p>O uso de value objects é uma técnica com um custo relativamente baixo que pode aumentar bastante a manutenibilidade e claridade do seu código. Colocando value objects em prática, você pode tornar seu código mais fácil de ser compreendido, criando interfaces que são auto-documentáveis, difíceis de serem usadas da maneira errada, e intrinsecamente <em>type-safe</em>.</p>

    <a href="/pt/value-objects-ferramenta/">leia mais...</a>
   </div>
  
  
  
  
  
  
  
  
    <span class="post-meta"><time datetime='16-10-2018'>16/10/2018</time></span> 
    <h2>
          <a class="post-link" href="/pt/boas-praticas-sem-tempo/">Boas Práticas De Programação Para Os Apressados</a>
    </h2>
    <div class="post-content">
    <p><img src="https://res.cloudinary.com/dz5ppacuo/image/upload/v1539703469/coding-best-practices-1038x437_ugnhab.jpg" alt="" />
Photo by Ales Nesetril on Unsplash</p>

<p><em>NOTA: Este post foi originalmente escrito para o blog da the SubMain.  Você pode <a href="https://blog.submain.com/coding-best-practices-short-time/">ler o artigo original no site deles, em inglês</a>. Quando estiver por lá, baixe e experimente o CodeIt.Right.</em></p>

<p>Um dos tópicos em desenvolvimento de software que me interessa muito são boas práticas de codificação. Eu estou sempre pesquisando e buscando maneiras de aperfeiçoar meu trabalho e entregar valor de forma rápida e consistente.</p>

<p>Pode ser meio espinhoso definir o que “<a href="https://www.daedtech.com/what-is-a-best-practice-in-software-development/">é realmente uma boa prática”</a>. Há pessoas que inclusive sugerem <a href="https://dzone.com/articles/death-best-practices">aposentar o termo!</a> Mas um ponto em que praticamente todos concordam é: descobrir e implementar estratégias - não importa o nome que você coloca nelas - para melhorar o resultado do seu trabalho é algo que qualquer programadora ou programador que faz jus a esse nome deveria fazer continuamente.</p>

<p>Claro, não existe almoço grátis. A adoção de uma boa prática leva tempo, o que você provavelmente não tem muito sobrando para começo de conversa. Isso sem mencionar a gerência, nem sempre muito animados a tentarem coisas novas.</p>

<p>Então, o que fazer se a sua equipe de desenvolvimento está sofrendo com a baixa qualidade de uma base de código, mas não tem tempo para implementar as boas práticas que remediariam a situação?</p>

<p>A resposta que eu ofereço é o que eu vou chamar de “pacote emergencial de boas práticas”: uma pequena lista de boas práticas de programação que você pode adotar em relativamente pouco tempo para levar sua equipe e sua aplicação do completo caos para um estado mais gerenciável.</p>

<p>Sim, eu sei que há tantos conselhos sobre boas práticas por aí que é até difícil não se sentir sobrecarregado. Por causa disso, eu restringi a minha lista de boas práticas a itens que atendam aos seguintes critérios:</p>

<ul>
  <li>As boas práticas precisam ser fundamentais, no sentido de que elas são blocos básicos a partir dos quais você pode implementar práticas mais sofisticadas depois.</li>
  <li>Você pode adotá-las em relativamente pouco tempo. (Eu diria que uma semana é praticável.)</li>
  <li>O seu custo é zero ou perto disso.</li>
</ul>

<p>As práticas a seguir atendem os critérios listados. E sem mais enrolação, aqui está: meu pacote emergencial de boas práticas de codificação, com itens listados na ordem que eles deveriam ser adotados, começando pelo mais crítico.</p>

<h2 id="sistema-de-controle-de-versão">Sistema de Controle de Versão</h2>

<p>Eu trabalhei uma vez em uma empresa de desenvolvimento de software na qual nenhum sistema de controle de versão era usado. Os arquivos de código fonte ficavam em uma pasta compartilhada que qualquer desenvolvedor podia acessar. Qual era o processo usado para poder editar um arquivo? Você provavelmente adivinhou: nós criávamos uma cópia do arquivo e adicionávamos “_OLD” ao final do nome.</p>

<p>Isso aconteceu há oito ou nove anos, o que significa que as coisas devem ter melhorado, certo? Bom, provavelmente melhoraram, um pouco, mas não totalmente. Ainda tem <a href="https://twitter.com/_m_b_j_/status/938785388268806146">empresas por aí que não usam controle de versão</a>.</p>

<h3 id="como-proceder">Como proceder?</h3>

<p>De agora em diante, eu vou assumir que você concorda que versionamento é uma boa prática fundamental. Caso esse não seja o caso, há muitos recursos pela web afora explicando <a href="https://www.git-tower.com/learn/git/ebook/en/desktop-gui/basics/what-is-version-control#start">o que um versionador é</a> e <a href="https://www.atlassian.com/git/tutorials/what-is-version-control#benefits-of-version-control">porque você deveria usar um.</a></p>

<p>Com isso resolvido, é hora de sermos mais específicos. Qual ferramenta usar? Como proceder com a sua adoção?</p>

<p><a href="https://git-scm.com/">Git</a> é uma escolha sólida. E apesar de ter uma curva de aprendizado mais acentuada para<a href="https://carlosschults.net/en/git-basics-for-tfs-users">quem já está mais acostumado com sistemas de controle de versão centralizados, como Subversion ou TFVC</a>, Git é o padrão <em>de facto</em> da indústria. Então, sem sombra de dúvidas, você deve aprender git. Não fazê-lo pode prejudicar a sua carreira no futuro.</p>

<p>Mas é possível que o Git não seja a melhor escolha para o seu time <strong>agora</strong>. Lembre-se, você não tem muito tempo. Nós precisamos que a sua equipe adote as boas práticas o mais rápido possível.</p>

<p>Como nós podemos fazer isso? Suponha que você tenha experiência com <a href="https://subversion.apache.org/">Subversion</a>, pois esse era o versionador usado na empresa que você trabalhou anteriormente. Sua experiência com Git, porém, é nenhuma. Se esse é o caso, eu diria que Subversion é a melhor escolha para você. Ter que aprender um novo sistema e ensiná-lo para seus colegas ao mesmo tempo que o coloca em vigor na empresa seria demais: você iria apenas se sobrecarregar.</p>

<h2 id="revisão-de-código">Revisão de Código</h2>

<p>Eu não vou mentir: eu sou um grande fã de revisão de código. E <a href="https://www.codinghorror.com/blog/archives/000495.html">eu não estou sozinho nisso.</a>. Eu já testemunhei em primeira mão como um bom processo de revisão de código pode reduzir o número de problemas em uma aplicação, tornar o código mais consistente e, mais importante ainda, espalhar conhecimento por todo o time de desenvolvimento.</p>

<p>E aqui vai uma ótima vantagem dessa prática: revisão de código é algo relativamente fácil de ser implementado. Comece da maneira mais simples possível, e então faça adaptações na sua abordagem conforme as necessidades aparecerem.</p>

<h3 id="minha-definição-de-revisão-de-código">Minha Definição de Revisão de Código</h3>

<p>Falar de revisão de código pode ser complicado. As pessoas às vezes tem ideias totalmente diferentes sobre o que a expressão significa. Então eu acho que uma clarificação se faz necessária.</p>

<p>Eu <strong>não</strong> sou a favor de um processo de revisão de código altamente burocrático e estressante, no qual o seu código é esmiuçado, em público, durante horas. Eu não acredito que envergonhar as pessoas em público é uma forma eficaz de aumentar a qualidade de um projeto. Ao contrário, <a href="https://carlosschults.net/pt/revisao-codigo-vs-programacao-em-par/">o tipo de revisão de código que eu defendo</a> é um processo simples, geralmente iniciado ao submeter um pull request ou usando sua IDE favorita.</p>

<h3 id="como-proceder-1">Como Proceder</h3>

<p>Agora que nós estamos sintonizados em relação ao significado de “revisão de código”, a próxima pergunta é: “como implementar isso na prática?” Da maneira mais simples possível que funcione.</p>

<p>Por exemplo, se a sua empresa desenvolve em .NET e usa TFS/TFVC, você pode começar <a href="https://marketplace.visualstudio.com/items?itemName=ColinD.ColinsALMCheckinPoliciesVS2017">instalando uma política de check-in</a> que exige uma revisão de código para cada check-in. Se a sua equipe usa GitHub, vocês podem usar <a href="https://help.github.com/articles/about-pull-requests/">pull requests</a>. Apenas comece a realizar revisões de código. Então, com o tempo, vá fazendo os ajustes e adaptações necessários.</p>

<p>Estas são algumas das questões que podem surgir ao refinar o seu processo:</p>

<ul>
  <li><strong>Qual é o objetivo da revisão de código?</strong> Estamos procurando por bugs? Tentando melhorar a legibilidade?Checando se o código adere ao padrão de codificação da empresa?</li>
  <li><strong>Como separamos “sugestões” de “impedimentos”?</strong> É OK recusar a alteração de alguém por causa de uma indentação ruim ou um nome de variável ligeiramente equivocado?</li>
  <li><strong>O que fazer se revisor e revisado não conseguem chegar a um consenso?</strong> Trazer um mediador para dar a palavra final? E quem seria essa pessoa?</li>
</ul>

<p>A resposta para todas as perguntas acima podem ser encontradas na <strong>automação</strong>. Uma boa parte do desconforto das revisões de códigos pode ser eliminada quando você emprega um <a href="https://blog.submain.com/different-styles-code-analyzer/">analisador de código</a> para lidar com as partes automatizáveis do processo.</p>

<p>Por exemplo, <a href="https://submain.com/codeit.right/features">SubMain possui um produto chamado CodeIt.Right</a> que oferece feedback em tempo real de dentro do Visual Studio, lhe alertando de possíveis problemas de codificação, inclusive corrigindo problemas quando possível.</p>

<p>Ao abraçar a automação, você deixa as pessoas da equipe livres para se preocuparem com questões de mais alto nível durante as revisões, como claridade do código ou decisões arquiteturais.</p>

<h2 id="builds-automatizados">Builds Automatizados</h2>

<p>Talvez você esteja pensando que eu me equivoquei nessa seção. Afinal de contas, sequer faz sentido falar de builds automatizados sem mencionar testes automatizados?</p>

<p>Eu vou argumentar que sim, faz sentido, por uma razão muito simples: builds automatizados eliminam o famoso problema de “<a href="https://blog.codinghorror.com/the-works-on-my-machine-certification-program/">na minha máquina funciona</a>”. </p>

<p>Ter um local central onde os builds são feitos joga luz em vários tipos de problemas, de mal gerenciamento de dependências a falta de disciplina em testes.</p>

<h3 id="como-proceder-2">Como Proceder</h3>

<p>Meu conselho aqui é o mesmo que na seção anterior: faça a coisa mais simples possível que funcione.</p>

<p>Se sua equipe já usa TFS, aprenda como <a href="https://docs.microsoft.com/en-us/vsts/build-release/actions/ci-cd-part-1">criar uma definição de build</a>. Se os seus projetos estão no GitHub, dê uma olhada no <a href="https://travis-ci.org/">Travis CI.</a></p>

<p>Com o tempo, você vai melhorando a sua estratégia. Lembra dos analisadores de código que eu mencionei anteriormente? É possível integrá-los no seu processo de build. <a href="https://carlosschults.net/pt/testes-unitarios-iniciantes-parte1">Testes unitários</a> e outros tipos de testes automatizados também são uma valiosa adição.</p>

<p>E por falar nisso…</p>

<h2 id="ausências-notáveis">Ausências Notáveis</h2>

<p>Você talvez tenha se surpreendido por minha lista de boas práticas não incluir testes unitários, mesmo eu sendo um defensor da importância de testes automatizados para a qualidade de uma aplicação. Qual é a razão disso?</p>

<p>Infelizmente, adicionar testes unitários a uma aplicação legada é muito difícil, ao ponto de existir até <a href="https://www.amazon.com/Working-Effectively-Legacy-Michael-Feathers/dp/0131177052/ref=sr_1_1?ie=UTF8&amp;qid=1515443597&amp;sr=8-1&amp;keywords=working+effectively+with+legacy+code">um livro famoso</a> que foca apenas nisso. Não é uma tarefa fácil de se fazer em pouco tempo.</p>

<p>Também é possível que muitos de vocês esperavam que eu falasse sobre código limpo ou os princípios <a href="https://en.wikipedia.org/wiki/SOLID_(object-oriented_design)">SOLID</a>. Eu encorajo vocês a lerem e pesquisarem sobre esses tópicos, mas eu não acredito que eles encaixam no propósito do post de hoje. Como o próprio nome deixa claro, eles são <em>princípios</em>. Pense neles como diretrizes filosóficas. Úteis? Claro. Mas não tão fáceis de decompor em conselhos pequenos, simples e acionáveis.</p>

<h2 id="implemente-essas-práticas-para-ontem">Implemente Essas Práticas Para Ontem!</h2>

<p>É possível que vários de vocês tenha achado essas práticas extremamente básicas e não dignas de um post. “Quem é que não usa controle de versão em 2018???”</p>

<p>Bom, não é tão difícil assim encontrar evidência (anedótica, mas ainda assim) que <a href="https://softwareengineering.stackexchange.com/questions/65931/are-there-serious-companies-that-dont-use-version-control-and-continuous-integr">as coisas ainda não são tão perfeitas</a>.</p>

<p>Acreditar que mesmo práticas tão fundamentais como versionamento de código ou testes automatizados são aplicadas universalmente é mais ingenuidade do que talvez queremos admitir.</p>

<p>Para o restante de vocês, eu espero que essa lista seja útil.</p>

<p>Você já deve ter ouvido o ditado. “Quando estiver em um buraco, para de cavar.” E é exatamente esse o tipo de ajuda que eu quis oferecer com esse post: correções rápidas e fáceis, para que você e as demais pessoas em seu tipo possam recuperar o suficiente de sanidade para poderem focar e recuperar o controle de sua aplicação, garantido sua saúde a longo prazo.</p>

    <a href="/pt/boas-praticas-sem-tempo/">leia mais...</a>
   </div>
  
  
  
  
  
  
  
  
    <span class="post-meta"><time datetime='11-07-2018'>11/07/2018</time></span> 
    <h2>
          <a class="post-link" href="/pt/4-erros-comuns-datetime-csharp/">4 Erros Comuns Com Data e Hora no C# — E como evitá-los</a>
    </h2>
    <div class="post-content">
    <p><img src="https://res.cloudinary.com/dz5ppacuo/image/upload/v1531165684/4-datetime-mistakes-1038x437_nm6csc.jpg" alt="" /></p>

<p><em>NOTA: Eu escrevi este post originalmente para o blog da SubMain.  Você pode <a href="https://blog.submain.com/4-common-datetime-mistakes-c-avoid/">conferir o original no site deles, em inglês</a>. Enquanto estiver por lá, dê uma conferida no CodeIt.Right, uma ferramenta que pode lhe ajudar com problemas relacionados a tempo e muitos outros.</em></p>

<p>Você se lembra daqueles posts no estilo “inverdades que programadores acreditam sobre <em>X</em>” que ficaram bastante populares em blogs de software há alguns anos? O primeiro foi sobre <a href="https://www.kalzumeus.com/2010/06/17/falsehoods-programmers-believe-about-names/">nomes</a>, mas logo apareceram vários outros, cobrindo tópicos como <a href="https://www.mjt.me.uk/posts/falsehoods-programmers-believe-about-addresses/">endereços</a>, <a href="https://wiesmann.codiferes.net/wordpress/?p=15187&amp;lang=en">geografia</a> e <a href="https://wiesmann.codiferes.net/wordpress/?p=22201">compras online</a>.</p>

<p>O meu favorito era <a href="https://infiniteundo.com/post/25326999628/falsehoods-programmers-believe-about-time">o post sobre tempo</a>. Até esse ponto, eu não havia pensado profundamente sobre tempo e e suas intricacies, e eu fiquei intrigado em saber que um domínio tão fundamental pudesse ser um terreno tão fértil para bugs e confusões.</p>

<p>Agora, mesmo eu tendo gostado do post, eu vejo um problema com ele: o post lista vários suposições erradas, e basicamente para por aí. Quem lê o artigo provavelmente termina se perguntando:</p>

<ul>
  <li>Por que essas suposições são falsas?</li>
  <li>Qual é a probabilidade de eu me dar mal por causa dessas inverdades?</li>
  <li>Qual é a maneira adequada de lidar com esses problemas?</li>
</ul>

<p>O artigo é interessante, mas eu acho que faria sentido oferecer informações um pouco mais acionáveis.</p>

<p>E é exatamente esse é o objetivo do post de hoje. Eu vou mostrar 4 erros comuns que as pessoas cometem ao lidar com tempo em C#/.NET. E não para por aí. Eu também vou mostrar o que você deve fazer para evitar esses erros e tornar seu código mais seguro e mais fácil de ser compreendido.</p>

<h2 id="1-calculando-durações-de-maneira-ingênua">1. Calculando Durações de Maneira Ingênua</h2>

<p>Considere o código abaixo:</p>

<script src="https://gist.github.com/carlosschults/3e18612b9a9238382b6d4fa3c574a231.js"></script>

<p>Ele funciona corretamente? Depende de onde e quando ele será executado.</p>

<p>Quando você usa <code class="highlighter-rouge">DateTime.Now</code>, o valor que você obtém representa a data e hora locais em relação à máquina atual (ou seja, a propriedade <code class="highlighter-rouge">Kind</code> está configurada para <code class="highlighter-rouge">Local</code>).</p>

<p>Se o lugar que você mora observa Horário de Verão, então você sabe que existe um dia do ano no qual você deve adiantar os relógios em uma certa medida (geralmente 1 hora, embora existam lugares que ajustam por outras quantidades). E é claro, existe também um dia no qual o oposto acontece.</p>

<p>Agora imagine o que seguinte: hoje é 12 de março de 2017, e você more na cidade de Nova York. Você começa a usar o programa acima. O método <code class="highlighter-rouge">StartMatch()</code> é executado exatamente às 13h. Uma hora e quinze minutos mais tarde, o método <code class="highlighter-rouge">EndMatch</code> é executado. O cálculo é realizado e o texto abaixo é exibido:</p>

<p><em>Duration of the match: 00:02:15</em></p>

<p>Eu imagino que você compreendeu o que aconteceu aqui: quando os relógios estavam prestes a marcar 14h, o Horário de Verão entrou em efeito, movendo-os diretamente para 15h. Então o método <code class="highlighter-rouge">EndMatch</code> recuperou o horário atual, somando uma hora adicional ao cálculo. Se o experimento tivesse acontecido no fim do Horário de Verão, o resultado seria apenas 15 minutos!</p>

<p>Sim, o código mostrado é apenas um exemplo, uma brincadeira. Mas e se fosse algo mais sério? Uma aplicação de folha de pagamento, digamos. Você gostaria de pagar o valor errado a um funcionário?</p>

<h3 id="o-que-fazer">O que fazer?</h3>

<p>Quando precisar calcular a duração de atividades humanas, use UTC para os tempos de início e fim. Dessa forma, você será capaz de <strong>referenciar de maneira não ambígua um ponto específico no tempo</strong>. Ao invés de usar a propriedade <code class="highlighter-rouge">Now</code>, use <code class="highlighter-rouge">UtcNow</code> para recuperar a data e hora já em formato UTC para realizar os cálculos:</p>

<script src="https://gist.github.com/carlosschults/82492845edaa8f8fc16c646ed2bbcf2a.js"></script>

<p>Mas e se os valores <code class="highlighter-rouge">DateTime</code> que você tem já são do tipo <code class="highlighter-rouge">Local</code>? Nesse caso, você deve usar o método <code class="highlighter-rouge">ToUniversalTime()</code> para convertê-los para UTC:</p>

<script src="https://gist.github.com/carlosschults/58837695af07386836753ef6541233aa.js"></script>

<h3 id="uma-rápida-advertência-sobre-touniversaltime">Uma Rápida Advertência Sobre <code class="highlighter-rouge">ToUniversalTime()</code></h3>

<p>O uso do método <code class="highlighter-rouge">ToUniversalTime()</code> - e seu irmão, <code class="highlighter-rouge">ToLocalTime()</code> - pode ser um pouco chato. O problema é que esses métodos fazem suposições sobre o que você quer baseados no valor da propriedade <code class="highlighter-rouge">Kind</code> do objeto datetime que você tem, o que pode trazer resultados inesperados.</p>

<p>Ao chamar <code class="highlighter-rouge">ToUniversalTime()</code>, uma das seguintes coisas vai acontecer:</p>

<ul>
  <li>Se <code class="highlighter-rouge">Kind</code> estiver configurado como UTC, o mesmo valor é retornado.</li>
  <li>Por outro lado, se estiver configurado como <code class="highlighter-rouge">Local</code>, então o valor correspondente em UTC é retornado.</li>
  <li>Finalmente, se <code class="highlighter-rouge">Kind</code> estiver como <code class="highlighter-rouge">Unspecified</code>, <strong>então é assumido que o objeto sempre teve a intenção de ser local,</strong>, e você recebe o valor correspondente à conversão para UTC.</li>
</ul>

<p>O problema aqui é que <a href="https://codeofmatt.com/2013/04/25/the-case-against-datetime-now/#localkindsdontroundtrip">valores de data/hora locais não não “transportáveis”</a>. Como assim? Eles são locais enquanto eles permanecerem no contexto da máquina atual. Se você salva um datetime local para um banco de dados e depois o recupera de lá, a informação de que ele é local se perde: agora ele é <code class="highlighter-rouge">Unspecified</code>.</p>

<p>Assim, o seguinte cenário pode acontecer:</p>

<ul>
  <li>Você recupera a data e hora atuais usando <code class="highlighter-rouge">DateTime.UtcNow</code>.</li>
  <li>Você salva esse valor no banco de dados.</li>
  <li>Outra parte do código recupera esse valor. Sem estar ciente de que o valor já está em UTC, chama o método <code class="highlighter-rouge">ToUniversalTime()</code> na instância.</li>
  <li>Como o valor recuperado do banco possui o tipo <code class="highlighter-rouge">Unspecified</code>, o método vai tratá-lo como local e realizar uma conversão desnecessária, gerando um valor errado.</li>
</ul>

<p>Como evitar que isso aconteça? Uma prática recomendada é usar UTC para armazenar o tempo em que um evento aconteceu. Minha sugestão é seguir esse conselho e também esse fato bem explícito. Coloque o sufixo “UTC” em cada coluna de tabela no banco de dados e também em nomes de propriedades que se referem a um valor em UTC. Ao invés de “Inclusao”, use “InclusaoUTC” e assim por diante. Não é tão bonito, mas com certeza é mais claro.</p>

<h2 id="2-não-usar-utc-quando-deveria-e-vice-versa">2. Não Usar UTC Quando Deveria (e vice-versa)</h2>

<p>Nós podemos definir isso como uma regra universal: use UTC para registrar quando eventos aconteceram. Ao logar, auditar, e registrar todo tipo de <em>timestamps</em> na sua aplicação, UTC é a resposta.</p>

<p>Então, é só usar UTC em todo lugar! Certo? Não, não tão rápido.</p>

<p>Digamos que você precisa ser capaz de reconstruir o tempo local - na perspectiva do usuário - de quando algo aconteceu, e a única informação que você tem é um <em>timestamp</em> em UTC. Mal dia.</p>

<p>Em casos assim, faria mais sentido (a) registrar o momento em UTC e gravar também o fuso horário do usuário ou (b) usar o tipo <code class="highlighter-rouge">DateTimeOffset</code>, que armazena a data/hora local junto com o deslocamento, ou <em>offset</em>, para UTC, permitindo que você reconstrua o valor em UTC quando precisar.</p>

<p>Outro caso de uso comum para o qual UTC não é a solução correta é  <a href="https://stackoverflow.com/questions/19626177/how-to-store-repeating-dates-keeping-in-mind-daylight-savings-time?noredirect=1&amp;lq=1">o agendamento de eventos locais no futuro</a>. Você não quer que seu alarme acorde você uma hora mais cedo ou uma hora mais tarde nos dias de transição do Horário de Verão, certo? Pois é exatamente isso que aconteceria se você configurasse o seu alarme pelo horário UTC.</p>

<h2 id="3-não-validar-entrada-dos-usuários">3. Não Validar Entrada dos Usuários</h2>

<p>Imagine que você criou uma aplicação desktop simples que permite que usuários configurem lembretes. A pessoa informa a data e hora que quer receber o lembrete, clica em um botão, e pronto.</p>

<p>Tudo parece estar funcionando direito até que alguém do Brasil envia um e-mail para você, reclamando que o lembrete que ela configurou para 15 de outubro às 0h15 não funcionou. O que será que aconteceu?</p>

<h3 id="o-horário-de-verão-contra-ataca">O Horário de Verão Contra Ataca</h3>

<p>O vilão aqui é o bom e velho Horário de Verão novamente. Em 2017, o Horário de Verão no Brasil começou à meia-noite do dia 15 de outubro. Então, a combinação de data e hora que a usuária informou <strong>simplesmente não existe em seu fuso-horário!</strong></p>

<p>É claro que o problema oposto também é possível. Quando o Horário de Verão chega ao fim e os relógios são atrasados, isso <strong>gera horas ambíguas</strong>.</p>

<h3 id="qual-é-a-solução">Qual É A Solução?</h3>

<p>Como lidar com esse tipo de problema no C#? A classe <code class="highlighter-rouge">TimeZoneInfo</code> pode lhe salvar. Ela serve para representar um fuso horário e também oferece métodos para verificar se um determinado objeto <code class="highlighter-rouge">DateTime</code> é válido:</p>

<script src="https://gist.github.com/carlosschults/2b94d57390b3518294730c01003f159c.js"></script>

<p>Mas o que fazer então? O que deveria substituir os comentários “do something” nos trechos acima?</p>

<p>Você poderia mostrar uma mensagem dizendo que a data informada é inválida. Ou você poderia escolher outra data para a pessoa automaticamente.</p>

<p>Vamos abordar o caso das horas inválidas primeiro. Suas opções são: mover para frente ou para trás. É uma decisão meio arbitrária, então qual você deve escolher? Por exemplo, o app do Google Calendar no Android move para frente. E até que faz sentido se você parar pra pensar. Isso é exatamente o que seus relógios fizeram devido ao horário de verão. Por que sua aplicação não pode fazer o mesmo?</p>

<p>E no caso das horas ambíguas? Você também tem duas opções: escolher entre a primeira e segunda ocorrências. Novamente, é meio arbitrário, mas eu aconselho você a escolher a primeira ocorrência, pelo simples fato de tornar as coisas mais simples.</p>

<h2 id="4-confundir-um-offset--com-um-fuso-horário">4. Confundir um <em>Offset</em>  com um Fuso Horário</h2>

<p>Considere o timestamp a seguir: 1995-07-14T13:05:00.0000000-03:00. Quando alguém pergunta o que o “-03:00” no final é chamado, muita gente responde “o fuso horário”.</p>

<p>A questão é essa. Essas pessoas provavelmente assumem corretamente que o número representa o offset, ou deslocamento, em relação a UTC. Também é provável que elas sabem que podem reconstruir a hora correspondente em UTC por meio desse offset. (Muitos desenvolvedores não entendem que, em uma string assim, o offset já está aplicado: para obter o tempo em UTC, você deve inverter o sinal do offset. E só depois, aplicá-lo ao valor da hora).</p>

<p>O erro está em achar que o offset é a única informação que um fuso horário representa. Mas não é. Um fuso horário é uma área geográfica, e contém muitas informações, tais como:</p>

<ul>
  <li>Um ou mais offsets. (Horário de verão existe, afinal de contas.)</li>
  <li>As datas nas quais as transições do horário de verão acontecem. (As quais podem mudar e mudam, sempre que os políticos resolvem).</li>
  <li>A quantidade de tempo pelo qual os relógios são atrasados ou adiantados na transição. (Não é uma hora em todo lugar.)</li>
  <li>O registro histórico das mudanças nas regras acima.</li>
</ul>

<p>Em resumo: não tente adivinhar um fuso horário pelo offset. Você vai errar a maioria das vezes.</p>

<h2 id="quer-aprender-sobre-tempo-já-não-era-sem-tempo">Quer aprender sobre tempo? Já não era sem tempo!</h2>

<p>Esta lista não é de forma alguma exausitiva. Eu apenas quis oferecer a vocês uma introdução ao fascinante e meio bizarro mundo dos problemas com hora e data em programação. Há muitos recursos valiosos por aí, como<a href="https://stackoverflow.com/tags/timezone/info">a tag time zone no Stack Overflow</a> ou blogs como <a href="https://codeblog.jonskeet.uk/">o de Jon Skeet</a> e <a href="https://codeofmatt.com/">o de Matt Johnson</a> que são autores da popular biblioteca NodaTime.</p>

<p>E finalmente, sempre use as ferramentas que estão à sua disposição. Por exemplo, <a href="https://blog.submain.com/codeit-right-rules-explained-part-2/">o produto da SubMain chamado CodeIt.Right</a> tem uma regra que você a especificar um <code class="highlighter-rouge">IFormatProvider</code> em situações nas quais é opcional, o que pode acabar salvando você de bugs difíceis ao fazer tratamento de datas.</p>

    <a href="/pt/4-erros-comuns-datetime-csharp/">leia mais...</a>
   </div>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <span class="post-meta"><time datetime='17-01-2018'>17/01/2018</time></span> 
    <h2>
          <a class="post-link" href="/pt/cargo-cult-programming/">Programação Cargo Cult É A Arte de Programar Por Coincidência</a>
    </h2>
    <div class="post-content">
    <p><img src="https://res.cloudinary.com/dz5ppacuo/image/upload/v1516152067/cargo-cult-programming-1037x438_spoxet.jpg" alt="" /></p>

<p><em>NOTA: Eu escrevi este post originalmente para o blog da NDepend. Você pode <a href="https://blog.ndepend.com/cargo-cult-programming/">clicar aqui para ler o artigo original no site deles, em inglês</a>. Enquanto estiver por lá, baixe e experimente o NDepend.</em></p>

<p>Eu ouvi falar em programação cargo cult a primeira vez há alguns anos. Eu me lembro de ter pensado na época: “Que nome estranho para um conceito relacionado com programação”.</p>

<p>Se você compartilha do estranhamento do meu “eu” do passado, o post de hoje é para você.</p>

<p>Primeiramente, você verá o que programação cargo cult é e por que você deve se importar. Então, vamos dar uma olhada em alguns exemplos práticos, usando a linguagem C#. Finalmente, nós encerraremos com conselhos sobre o que você pode fazer para não cair nessa armadilha.</p>

<h2 id="programação-cargo-cult-fazendo-as-coisas-porque-sim">Programação Cargo Cult: Fazendo as coisas porque sim.</h2>

<p>Segundo a versão em inglês da <a href="https://en.wikipedia.org/wiki/Cargo_cult_programming">Wikipedia</a></p>

<blockquote>
  <p>Cargo cult programming is a style of computer programming characterized by the ritual inclusion of code or program structures that serve no real purpose.</p>
</blockquote>

<p>Em tradução livre</p>

<blockquote>
  <p>Programação <em>cargo cult</em> é um estilo de programação de computadores caracterizado pela inclusão ritualística de código ou estruturas de programação que não servem nenhum propósito real.</p>
</blockquote>

<p>Em outras palavras, é quando um(a) desenvolvedor(a) escreve código sem entender realmente o que aquele código faz. Talvez uma abordagem por tentativa e erro tenha sido usada - copia o código de um lugar, cola em outro, e vai mexendo e testando até que funciona, mais ou menos. Quando chega nesse ponto a pessoa geralmente para de mexer no código, por medo de fazer parar de funcionar. No processo, talvez sobrem resquícios de código que não servem realmente para nada.</p>

<p>Ou talvez a pessoa tenha tentado usar uma técnica aprendida com um colega, mas falhou em compreender que os conceitos são diferentes e que a tal técnica é inútil na situação atual.</p>

<p>Por fim, também é possível que o problema seja simplesmente educação insuficiente: talvez o desenvolvedor tenha um entendimento pobre a respeito de como as ferramentas usadas funcionam.</p>

<h2 id="por-que-a-programação-cargo-cult-é-um-problema">Por que a programação <em>cargo cult</em> é um problema?</h2>
<p>Como Eric Lippert diz, <a href="https://blogs.msdn.microsoft.com/ericlippert/2004/03/01/syntax-semantics-micronesian-cults-and-novice-programmers/">programadores cargo cult sofrem para fazer alterações significativas em um programa</a> e acabam usando uma abordagem de tentativa e erro já que eles não entendem o funcionamento interno do código que estão prestes a alterar.</p>

<p>Isso não é tão diferente do que os <a href="https://pragprog.com/the-pragmatic-programmer/extracts/coincidence">programadores pragmáticos chamam de “programação por coincidência”</a>:</p>

<blockquote>
  <p>Fred doesn’t know why the code is failing because he didn’t know why it worked in the first place. It seemed to work, given the limited “testing” that Fred did, but that was just a coincidence.</p>
</blockquote>

<p>Em tradução livre:</p>

<blockquote>
  <p>Fred não sabe porque o código está falhando porque ele não sabe porque ele funcionou da primeira vez. Parecia estar funcionando, com o “teste” limitado que Fred fez, mas era apenas uma coincidência.</p>
</blockquote>

<p>A frase acima resume tudo para mim: se você não sabe como ou por que seu código funciona, você também não vai entender o que aconteceu quando ele parar de funcionar.</p>

<h2 id="origem-do-termo">Origem do termo</h2>
<p>Embora práticas que são consideradas “culto à carga” (<em>cargo cult</em>) atualmente <a href="https://en.wikipedia.org/wiki/Cargo_cult#First_occurrences">tenham sido registradas tão cedo quanto o final do século XIX</a>, o termo em si data de 1945, quando foi usado pela primeira vez para descrever práticas que surgiram durante e depois da Segunda Guerra Mundial entre habitantes da Melanésia.</p>

<p>Os nativos começaram a imitar o comportamento dos soldados, vestindo-se como controladores de voo e balançando gravetos, na esperança de que isso faria com que aviões carregados de suprimentos descessem dos céus.</p>

<p>Desde então, o termo culto à carga tem sido usado em uma variedade de contextos para significar <strong>imitar forma sem conteúdo</strong> - copiar perfeitamente os elementos superficiais mas ao mesmo tempo falhando em entender de maneira mais profunda o significado e funcionamento do que se está tentando emular.</p>

<h2 id="falar-é-fácil-me-mostre-o-código">Falar é fácil; me mostre o código!</h2>
<p>Chega da aula de História por hoje. Hora de ver código! Eu vou mostrar cinco exemplos de programação cargo cult usando a linguagem C#. Vamos lá.</p>

<h3 id="checar-um-tipo-de-valor-não-nulável-for-null">Checar um tipo de valor não-nulável for <em>Null</em></h3>
<p>O primeiro item é algo que me incomoda já que eu vejo isso bastante em código de produção. É algo assim:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#">	<span class="k">public</span> <span class="n">Product</span> <span class="nf">Find</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span>
	<span class="p">{</span>
   	   <span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="c1">// essa verificação é inútil</span>
	   <span class="p">{</span>
	       <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Esta linha sempre será executada."</span><span class="p">);</span>
	   <span class="p">}</span>
	
	   <span class="k">return</span> <span class="k">new</span> <span class="nf">Product</span><span class="p">();</span>
	<span class="p">}</span></code></pre></figure>

<p>Aqui nós temos o caso de um(a) desenvolvedor(a) que provavelmente não entende a <a href="https://carlosschults.net/pt/tipos-valor-referencia-em-csharp/">diferença entre tipos de valor e referência</a>. Seria completamente perdoável, no caso de um profissional iniciante, se não fosse pelo fato de que o compilador te avisa disso.</p>

<p>Você pode achar isso um exagero da minha parte. Afinal de contas, o código vai rodar perfeitamente mesmo assim. Na verdade, a verificação não será nem ao mesma incluída no IL resultante, como você pode ver nesse print de uma ferramenta de descompilação:</p>

<p><img src="https://res.cloudinary.com/dz5ppacuo/image/upload/v1515684957/just-decompile1_qk69k2.png" alt="Uma imagem mostrando um trecho de código que não contem a checagem de nulo." /></p>

<p>Você pode ver no trecho de código acima que o compilador otimizou o código, removendo a checagem por nulo.</p>

<p>Tem problemas muito piores, claro. Sim, a aplicação não vai <em>quebrar</em> por causa disso. Então, qual é o ponto?</p>

<p>Bom, pra começo de conversa, eu me preocuparia com uma empresa de desenvolvimento cujo único critério de qualidade é “roda sem quebrar”. Mas o problema de verdade aqui é que esse tipo de código demonstra uma falta de entendimento sobre características fundamentais da linguagem e da plataforma que podem lhe causar problemas no futuro.</p>

<h3 id="uso-desnecessário-de-tolist-em-consultas-do-linq-to-object">Uso Desnecessário de <code class="highlighter-rouge">ToList()</code> em consultas do LINQ to Object</h3>
<p>Assim como o problema anterior, o item atual é algo que eu rotineiramente vejo em código de produção. Considere o código abaixo:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#">	<span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">users</span><span class="p">.</span><span class="nf">ToList</span><span class="p">()</span>
	<span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">PremiumUser</span><span class="p">)</span>
	<span class="p">.</span><span class="nf">ToList</span><span class="p">()</span>
	<span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="p">{</span> <span class="n">Name</span> <span class="p">=</span> <span class="n">x</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">Birth</span> <span class="p">=</span> <span class="n">x</span><span class="p">.</span><span class="n">DateOfBirth</span> <span class="p">})</span>
	<span class="p">.</span><span class="nf">ToList</span><span class="p">();</span></code></pre></figure>

<p>O problema que temos aqui é que as chamadas ao método <code class="highlighter-rouge">ToList()</code> são totalmente desnecessárias (exceto talvez a última, caso você realmente precisasse que o resultado fosse um lista e não apenas um <code class="highlighter-rouge">IEnumerable</code>).</p>

<p>Em minha experiência, isso acontece quando quem escreveu o código não entende bem a natureza do LINQ; eles erroneamente acham que os métodos do LINQ pertencem ao tipo concreto <code class="highlighter-rouge">List&lt;T&gt;</code> ao invés de serem métodos de extensão que podem ser usados com qualquer implementação de <code class="highlighter-rouge">IEnumerable&lt;T&gt;</code>.</p>

<p>Ao chamar <code class="highlighter-rouge">ToList()</code> diversas vezes dessa forma, o desenvolvedor na verdade cria diversas listas novas, o que pode prejudicar o desempenho da aplicação.</p>

<p>O código acima pode ser reescrito da seguinte forma:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#">	<span class="kt">var</span> <span class="n">result</span> <span class="p">=</span> <span class="n">users</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">PremiumUser</span><span class="p">).</span><span class="nf">Select</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="p">{</span> <span class="n">Name</span> <span class="p">=</span> <span class="n">x</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">Birth</span> <span class="p">=</span> <span class="n">x</span><span class="p">.</span><span class="n">DateOfBirth</span> <span class="p">});</span></code></pre></figure>

<h3 id="conversões-desnecessárias">Conversões Desnecessárias</h3>
<p>Considere a linha seguinte:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#">	<span class="n">DateTime</span> <span class="n">creationDate</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">"creation_date"</span><span class="p">].</span><span class="nf">ToString</span><span class="p">());</span></code></pre></figure>

<p>Aqui temos não apenas uma mas duas conversões desnecessárias. Primeiro, criamos uma nova string e então a “parseamos” para <code class="highlighter-rouge">DateTime</code> quando um simples <em>cast</em> seria suficiente:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#">	<span class="n">DateTime</span> <span class="n">creationDate</span> <span class="p">=</span> <span class="p">(</span><span class="n">DateTime</span><span class="p">)</span><span class="n">row</span><span class="p">[</span><span class="s">"creation_date"</span><span class="p">];</span></code></pre></figure>

<p>Esse exemplo assume que o tipo no banco de dados é um tipo específico para lidar com datas (como <code class="highlighter-rouge">date</code> ou <code class="highlighter-rouge">datetime</code> no SQL Server). É claro que se você estivesse usando um tipo inadequado (como <code class="highlighter-rouge">varchar</code>) então isso já seria um outro problema.</p>

<h3 id="try-catch-em-todo-lugar"><code class="highlighter-rouge">Try-Catch</code> em todo lugar</h3>
<p>Também conhecido como síndrome Pokémon (“Gotta catch’em all!”), o <em>anti-pattern</em> aqui é adicionar um bloco <code class="highlighter-rouge">try-catch</code> em cada linha em que exista a remota possibilidade de uma exceção ser disparada.</p>

<p>Pontos bônus se o código estiver tentando capturar <code class="highlighter-rouge">System.Exception</code> ao invés de uma exceção mais específica, acabando com a distinção entre erros esperados e não esperados.</p>

<p>Mais pontos se o bloco do <code class="highlighter-rouge">catch</code> não conter código nenhum!</p>

<p>A dica geral aqui é: jamais capture uma exceção a não ser que você tenha uma razão muito específica para fazê-lo. Do contrário, deixe que a exceção suba até que o gerenciador de exceções geral no nível mais alto lide com ela.</p>

<p>Se esse conselho parece vago (“Como vou saber se eu tenho uma boa razão para capturar a exceção?”), é porque de fato é. Explorar esse tema mais a fundo iria além do escopo desse post, , mas <a href="https://blogs.msdn.microsoft.com/ericlippert/2008/09/10/vexing-exceptions/">ler o excelente artigo do Eric Lippert chamado “Vexing Exceptions”</a> vai aumentar e muito o seu entendimento sobre exceções.</p>

<h3 id="usar-stringbuilder-demais">Usar <code class="highlighter-rouge">StringBuilder</code> Demais</h3>
<p>Você já deve ter visto o filme: depois de ler em algum lugar que concatenar strings usando <code class="highlighter-rouge">+</code> é ineficiente, nosso intrépido desenvolvedor resolve tomar pra si a tarefa hercúlea de mudar cada concatenação de string no projeto para o uso de <code class="highlighter-rouge">StringBuilder</code>.</p>

<p>A justificativa para isso, claro, é que <code class="highlighter-rouge">System.String</code> é imutável. Então, cada vez que você “muda” a string, você na verdade está criando uma instância nova na memória, o que pode prejudicar o desempenho da aplicação.</p>

<p>Mas adivinha só. O compilador é bem esperto. Digamos que você tenha a seguinte linha:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#">	<span class="kt">string</span> <span class="n">a</span> <span class="p">=</span> <span class="s">"Hello "</span> <span class="p">+</span> <span class="s">"World"</span><span class="p">;</span></code></pre></figure>

<p>Isso vai ser no fim das contas traduzido para:</p>

<figure class="highlight"><pre><code class="language-c#" data-lang="c#">	<span class="kt">string</span> <span class="n">a</span> <span class="p">=</span> <span class="s">"Hello World"</span><span class="p">;</span></code></pre></figure>

<p>A regra geral é: tudo bem usar concatenação simples se você sabe o número de strings a anexar em tempo de compilação. Do contrário, <a href="https://stackoverflow.com/a/21644889">o uso de <code class="highlighter-rouge">StringBuilder</code> provavelmente faz mais sentido</a>.</p>

<p>Lógico, alguns cenários não são tão claros assim. O único conselho que faz sentido dar aqui é: faça seu dever de casa. Quando estiver com dúvida, pesquise e faça <em>benchmark</em> sem dó.</p>

<p>Eu termino com mais uma dica sensata do Eric Lippert:</p>

<blockquote>
  <p>Unnecessary code changes are expensive and dangerous; <strong>don’t make performance-based changes unless you’ve identified a performance problem.</strong></p>
</blockquote>

<h2 id="existe-solução">Existe Solução?</h2>
<p>Eu diria que é justo supor que pessoas com menos experiência são mais propensas a cometer erros devido à programação cargo cult. Mas desenvolvedor nenhum está realmente a salvo, independentemente de seu nível de conhecimento ou experiência.</p>

<p>Nós somos apenas humanos no fim das contas. Cansaço, prazos, vieses cognitivos e (para ser realmente honesto) a preguiça eventual pode transformar até o melhor de nós em um programador cargo cult.</p>

<p>Infelizmente, não há uma maneira 100% garantida de impedir isso de acontecer. Mesmo assim, aqui vão algumas medidas que você pode tomar para, ao menos, diminuir as chances.</p>

<p>Vamos ver algumas delas.</p>

<h3 id="use-revisão-de-códigoprogramação-em-par">Use Revisão de Código/Programação em Par</h3>
<p>A primeira medida que você pode tomar para evitar o cargo cult é simplesmente ter uma segunda pessoa olhando seu código. Os benefícios de ter uma outra pessoa revisando cada linha de código antes que ela chegue em produção não podem ser subestimados. E embora <a href="https://blog.submain.com/code-review-vs-pair-programming-2/">revisão de código e programação em par não são exatamente equivalentes</a>, ambas as práticas podem lhe trazer esse benefício.</p>

<h3 id="sempre-teste-suas-hipóteses">Sempre Teste Suas Hipóteses</h3>
<p>Escreva <a href="https://carlosschults.net/pt/testes-unitarios-iniciantes-parte1">testes de unidade</a> (e outros tipos de testes também). Monitore sua aplicação em produção. Se algo não está tendo um bom desempenho, faça <em>benchmarks</em> exaustivos. Não faça só suposições. Testar as suas hipóteses pode trazer <em>insights</em> valiosos e salvar a sua pele naqueles momentos em que a sua intuição não for certeira.</p>

<h3 id="leia-código-de-outras-pessoas">Leia Código de Outras Pessoas</h3>
<p>Ler código escrito por outras pessoas é uma ótima maneira de aprender. É uma ferramenta perfeita para comparar suas ideias e suposições contra o que outros desenvolvedores estão fazendo, expondo você a novos conceitos que podem lhe forçar a ganhar um entendimento maior dos problemas que está tentando resolver.</p>

<p>Na era do <a href="https://github.com/">GitHub</a>, não tem muita desculpa para não fazer isso.</p>

<h3 id="aprenda-com-suas-ferramentas">Aprenda Com Suas Ferramentas</h3>
<p>Existe um número enorme de ferramentas que podem ajudar <a href="https://www.ndepend.com/">sua equipe com a qualidade do seu código</a>. Aqui vai a dica principal: você não deve só usar essas ferramentas. Você deve também aprender com elas. Se você usa NDepend, <a href="https://www.ndepend.com/default-rules/webframe.html">leia sobre suas regras</a>. Tente entender a justificativa por trás de cada uma delas. Quais são os princípios e boas práticas que guiaram seus autores durante a criação delas?</p>

<p>A mesma dica vale para outros tipos de ferramentas, e até para os warnings que o compilador lhe mostra.</p>

<h2 id="ciência-da-computação-não-superstição-da-computação">Ciência da Computação, Não <em>Superstição</em> da Computação</h2>
<p>Embora ninguém seja imune à programação cargo cult, nós devemos nos esforçar para superá-la. Há sabedoria na nossa área à nossa disposição, acumulada lentamente ao longo de mais de 7 década. Vamos usá-la. Vamos entender melhor nossas ferramentas e nossa profissão e escrever software de qualidade.</p>

    <a href="/pt/cargo-cult-programming/">leia mais...</a>
   </div>
  
  
  
  
  
  
  
  
  
  
    <span class="post-meta"><time datetime='20-12-2017'>20/12/2017</time></span> 
    <h2>
          <a class="post-link" href="/pt/funcionalidades-csharp8/">Funcionalidades do C# 8.0: Um Vislumbre do Futuro</a>
    </h2>
    <div class="post-content">
    <p><img src="https://res.cloudinary.com/dz5ppacuo/image/upload/v1513817072/csharp8-1037x438_skogpz.jpg" alt="" /></p>

<p>C# 8.0 está chegando e vai trazer algumas funcionalidades muito interessantes. Vamos dar uma olhada no que o futuro reserva.</p>


    <a href="/pt/funcionalidades-csharp8/">leia mais...</a>
   </div>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <span class="post-meta"><time datetime='08-08-2017'>08/08/2017</time></span> 
    <h2>
          <a class="post-link" href="/pt/testes-unitarios-iniciantes-parte-2">Testes Unitários Para Iniciantes - Parte 2</a>
    </h2>
    <div class="post-content">
    <p><img src="https://res.cloudinary.com/dz5ppacuo/image/upload/v1459979937/testes-unitarios-iniciantes-min_povcse.png" alt="" /></p>

<p>Antes tarde do que mais tarde! Hora de continuar nossa série sobre testes unitários para iniciantes. Hoje você vai escrever seu primeiro teste unitário.</p>


    <a href="/pt/testes-unitarios-iniciantes-parte-2">leia mais...</a>
   </div>
  
  
  
  
  
  
  
  
  
  
  
  
    <span class="post-meta"><time datetime='08-08-2017'>08/08/2017</time></span> 
    <h2>
          <a class="post-link" href="/pt/testes-unitarios-iniciantes-parte-2">Testes Unitários Para Iniciantes - Parte 2</a>
    </h2>
    <div class="post-content">
    <p><img src="https://res.cloudinary.com/dz5ppacuo/image/upload/v1459979937/testes-unitarios-iniciantes-min_povcse.png" alt="" /></p>

<p>Antes tarde do que mais tarde! Hora de continuar nossa série sobre testes unitários para iniciantes. Hoje você vai escrever seu primeiro teste unitário.</p>


    <a href="/pt/testes-unitarios-iniciantes-parte-2">leia mais...</a>
   </div>
  
  
  
  
  
  
  
  
    <span class="post-meta"><time datetime='05-06-2017'>05/06/2017</time></span> 
    <h2>
          <a class="post-link" href="/pt/funcionalidades-csharp-7-parte-2">Funcionalidades do C# 7 que vale a pena conhecer - Parte 2</a>
    </h2>
    <div class="post-content">
    <p><img src="https://res.cloudinary.com/dz5ppacuo/image/upload/v1489452722/charp7-features-cover_ciekql.jpg" alt="" /></p>

<p>Neste artigo, vamos continuar a ver algumas das features mais interessantes do C# 7.</p>


    <a href="/pt/funcionalidades-csharp-7-parte-2">leia mais...</a>
   </div>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <span class="post-meta"><time datetime='13-03-2017'>13/03/2017</time></span> 
    <h2>
          <a class="post-link" href="/pt/funcionalidades-csharp-7/">Funcionalidades do C# 7 que vale a pena conhecer - Parte 1</a>
    </h2>
    <div class="post-content">
    <p><img src="https://res.cloudinary.com/dz5ppacuo/image/upload/v1489452722/charp7-features-cover_ciekql.jpg" alt="" /></p>

<p>C# 7 está finalmente entre nós. Hora de conhecer algumas de suas features.</p>


    <a href="/pt/funcionalidades-csharp-7/">leia mais...</a>
   </div>
  
  
  
  
  
  
  
  
    <span class="post-meta"><time datetime='06-03-2017'>06/03/2017</time></span> 
    <h2>
          <a class="post-link" href="/pt/funcionalidades-csharp-6/">Já está na hora de começar a usar essas features do C# 6!</a>
    </h2>
    <div class="post-content">
    <p><img src="https://res.cloudinary.com/dz5ppacuo/image/upload/v1487896790/csharp6features_y5czrf.jpg" alt="" /></p>

<p>A sétima versão do C# está chegando, e vai provavelmente trazer várias funcionalidades novas e úteis para nossas  caixas de ferramentas. Mas deixa eu perguntar uma coisa: você já está usando as funcionalidades da versão anterior?</p>


    <a href="/pt/funcionalidades-csharp-6/">leia mais...</a>
   </div>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <span class="post-meta"><time datetime='19-06-2016'>19/06/2016</time></span> 
    <h2>
          <a class="post-link" href="/pt/tipos-valor-referencia-em-csharp-parte-2/">Tipos de valor e referência em C#, Parte 2 - Por que DateTime não pode ser nulo?</a>
    </h2>
    <div class="post-content">
    <p><img src="https://res.cloudinary.com/dz5ppacuo/image/upload/v1466341001/csharp-min_buiizq.png" alt="" /></p>

<p>“Por que uma variável DateTime não pode receber <code class="highlighter-rouge">null</code>?” Esta é uma pergunta que vive aparecendo no <em>StackOverflow</em> e site similares. Às vezes escrita de modo um pouco diferente, às vezes com um tipo diferente, mas no fundo é a mesma dúvida. O que é natural, se você considerar que provavelmente milhares de pessoas entram na área a cada ano.</p>


    <a href="/pt/tipos-valor-referencia-em-csharp-parte-2/">leia mais...</a>
   </div>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <span class="post-meta"><time datetime='30-01-2016'>30/01/2016</time></span> 
    <h2>
          <a class="post-link" href="/pt/tipos-valor-referencia-em-csharp/">Tipos de valor e referência em C#</a>
    </h2>
    <div class="post-content">
    <p><img src="https://res.cloudinary.com/dz5ppacuo/image/upload/v1466341001/csharp-min_buiizq.png" alt="" /></p>

<p>Este é o meu primeiro post pra valer aqui no meu blog, e eu decidi escrever sobre tipos de valor e tipos de referência em C#. Isso é um assunto relativamente básico, no sentido de que é algo que você já deveria entender caso você programe em C# profissionalmente. Mas ao mesmo tempo, é algo que pode ser um pouco contra-intuitivo caso você não seja um desenvolvedor experiente.</p>


    <a href="/pt/tipos-valor-referencia-em-csharp/">leia mais...</a>
   </div>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  



      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">
    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">         
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/carlosschults"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">carlosschults</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/carlosschults"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">carlosschults</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Artigos sobre desenvolvimento de software, banco de dados e vários assuntos ligados à tecnologia.</p>
      </div>
    </div>

  </div>

</footer>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-92788641-1', 'auto');
  ga('send', 'pageview');

</script>

  </body>

</html>
